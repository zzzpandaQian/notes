<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目部署 | 还隔这查文档，我上来就是一拳</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/notes/assets/css/0.styles.046e0507.css" as="style"><link rel="preload" href="/notes/assets/js/app.693f674f.js" as="script"><link rel="preload" href="/notes/assets/js/2.ee803d5e.js" as="script"><link rel="preload" href="/notes/assets/js/41.cb3f7d02.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.8df4875c.js"><link rel="prefetch" href="/notes/assets/js/100.8bdd21e6.js"><link rel="prefetch" href="/notes/assets/js/101.6e8be7dd.js"><link rel="prefetch" href="/notes/assets/js/102.53ab07dc.js"><link rel="prefetch" href="/notes/assets/js/103.9a825864.js"><link rel="prefetch" href="/notes/assets/js/104.aa5af432.js"><link rel="prefetch" href="/notes/assets/js/105.ea9a56c7.js"><link rel="prefetch" href="/notes/assets/js/106.ec33f3ad.js"><link rel="prefetch" href="/notes/assets/js/107.e7009964.js"><link rel="prefetch" href="/notes/assets/js/108.52c1f920.js"><link rel="prefetch" href="/notes/assets/js/109.65d686e4.js"><link rel="prefetch" href="/notes/assets/js/11.1496d8e0.js"><link rel="prefetch" href="/notes/assets/js/110.dd503851.js"><link rel="prefetch" href="/notes/assets/js/111.713cd005.js"><link rel="prefetch" href="/notes/assets/js/112.b008e42d.js"><link rel="prefetch" href="/notes/assets/js/113.8765549b.js"><link rel="prefetch" href="/notes/assets/js/114.c1ab5490.js"><link rel="prefetch" href="/notes/assets/js/115.3d9d10df.js"><link rel="prefetch" href="/notes/assets/js/116.21bac402.js"><link rel="prefetch" href="/notes/assets/js/117.80ca349e.js"><link rel="prefetch" href="/notes/assets/js/118.264dfbfd.js"><link rel="prefetch" href="/notes/assets/js/119.94abe060.js"><link rel="prefetch" href="/notes/assets/js/12.48b964d8.js"><link rel="prefetch" href="/notes/assets/js/120.a1e95cca.js"><link rel="prefetch" href="/notes/assets/js/121.920f0871.js"><link rel="prefetch" href="/notes/assets/js/122.fa2c1331.js"><link rel="prefetch" href="/notes/assets/js/123.ae900d0b.js"><link rel="prefetch" href="/notes/assets/js/124.a681e4ad.js"><link rel="prefetch" href="/notes/assets/js/125.9dc36731.js"><link rel="prefetch" href="/notes/assets/js/126.19b0b6f6.js"><link rel="prefetch" href="/notes/assets/js/127.753e1762.js"><link rel="prefetch" href="/notes/assets/js/128.04d224d3.js"><link rel="prefetch" href="/notes/assets/js/129.96ed219e.js"><link rel="prefetch" href="/notes/assets/js/13.7a358a5b.js"><link rel="prefetch" href="/notes/assets/js/130.31efda50.js"><link rel="prefetch" href="/notes/assets/js/131.1fbd9731.js"><link rel="prefetch" href="/notes/assets/js/132.24cbfa83.js"><link rel="prefetch" href="/notes/assets/js/133.3d541007.js"><link rel="prefetch" href="/notes/assets/js/134.87101ac5.js"><link rel="prefetch" href="/notes/assets/js/135.25562a0d.js"><link rel="prefetch" href="/notes/assets/js/136.55d387c0.js"><link rel="prefetch" href="/notes/assets/js/137.b70e6a0a.js"><link rel="prefetch" href="/notes/assets/js/138.b4a0d289.js"><link rel="prefetch" href="/notes/assets/js/139.eb1b9d08.js"><link rel="prefetch" href="/notes/assets/js/14.fb3a52e3.js"><link rel="prefetch" href="/notes/assets/js/140.906e8f92.js"><link rel="prefetch" href="/notes/assets/js/141.a9c1d0ff.js"><link rel="prefetch" href="/notes/assets/js/142.10d4f3f3.js"><link rel="prefetch" href="/notes/assets/js/143.70d396fb.js"><link rel="prefetch" href="/notes/assets/js/144.cf7ba1e8.js"><link rel="prefetch" href="/notes/assets/js/145.3056455a.js"><link rel="prefetch" href="/notes/assets/js/146.97300387.js"><link rel="prefetch" href="/notes/assets/js/147.c552d920.js"><link rel="prefetch" href="/notes/assets/js/148.24cd5671.js"><link rel="prefetch" href="/notes/assets/js/149.39dd402e.js"><link rel="prefetch" href="/notes/assets/js/15.c8adf5ed.js"><link rel="prefetch" href="/notes/assets/js/150.1e0e74cc.js"><link rel="prefetch" href="/notes/assets/js/151.7a5ef1a1.js"><link rel="prefetch" href="/notes/assets/js/152.82103aef.js"><link rel="prefetch" href="/notes/assets/js/153.64f23cb0.js"><link rel="prefetch" href="/notes/assets/js/154.e10ca008.js"><link rel="prefetch" href="/notes/assets/js/155.26add57a.js"><link rel="prefetch" href="/notes/assets/js/156.baba0d11.js"><link rel="prefetch" href="/notes/assets/js/157.9ed8cc70.js"><link rel="prefetch" href="/notes/assets/js/158.a8f99100.js"><link rel="prefetch" href="/notes/assets/js/159.7a274487.js"><link rel="prefetch" href="/notes/assets/js/16.06250b71.js"><link rel="prefetch" href="/notes/assets/js/160.bf19e881.js"><link rel="prefetch" href="/notes/assets/js/161.ca8ce943.js"><link rel="prefetch" href="/notes/assets/js/162.ca4bba30.js"><link rel="prefetch" href="/notes/assets/js/163.3a76e583.js"><link rel="prefetch" href="/notes/assets/js/164.6ab4321a.js"><link rel="prefetch" href="/notes/assets/js/165.cdb63940.js"><link rel="prefetch" href="/notes/assets/js/166.5a97199c.js"><link rel="prefetch" href="/notes/assets/js/167.7e3ec094.js"><link rel="prefetch" href="/notes/assets/js/168.035592fa.js"><link rel="prefetch" href="/notes/assets/js/169.366a4304.js"><link rel="prefetch" href="/notes/assets/js/17.a6f856ad.js"><link rel="prefetch" href="/notes/assets/js/170.7c9cc147.js"><link rel="prefetch" href="/notes/assets/js/171.cf5a48d8.js"><link rel="prefetch" href="/notes/assets/js/172.19e2f582.js"><link rel="prefetch" href="/notes/assets/js/173.9a12226f.js"><link rel="prefetch" href="/notes/assets/js/174.f083b849.js"><link rel="prefetch" href="/notes/assets/js/18.9be01929.js"><link rel="prefetch" href="/notes/assets/js/19.0bff607d.js"><link rel="prefetch" href="/notes/assets/js/20.cceec89f.js"><link rel="prefetch" href="/notes/assets/js/21.876e28fc.js"><link rel="prefetch" href="/notes/assets/js/22.89577694.js"><link rel="prefetch" href="/notes/assets/js/23.fc1bb7ef.js"><link rel="prefetch" href="/notes/assets/js/24.e7122983.js"><link rel="prefetch" href="/notes/assets/js/25.02c1de2c.js"><link rel="prefetch" href="/notes/assets/js/26.16d528fe.js"><link rel="prefetch" href="/notes/assets/js/27.efc0eba1.js"><link rel="prefetch" href="/notes/assets/js/28.d688a8e3.js"><link rel="prefetch" href="/notes/assets/js/29.2584d6d0.js"><link rel="prefetch" href="/notes/assets/js/3.c81b0709.js"><link rel="prefetch" href="/notes/assets/js/30.5bef4ddc.js"><link rel="prefetch" href="/notes/assets/js/31.0b0aa28e.js"><link rel="prefetch" href="/notes/assets/js/32.f91948f2.js"><link rel="prefetch" href="/notes/assets/js/33.65519de3.js"><link rel="prefetch" href="/notes/assets/js/34.6a59642b.js"><link rel="prefetch" href="/notes/assets/js/35.0b951c50.js"><link rel="prefetch" href="/notes/assets/js/36.c1229a87.js"><link rel="prefetch" href="/notes/assets/js/37.f45f88c7.js"><link rel="prefetch" href="/notes/assets/js/38.a292be28.js"><link rel="prefetch" href="/notes/assets/js/39.ac7b814f.js"><link rel="prefetch" href="/notes/assets/js/4.acc16a77.js"><link rel="prefetch" href="/notes/assets/js/40.6d1a2236.js"><link rel="prefetch" href="/notes/assets/js/42.57119e51.js"><link rel="prefetch" href="/notes/assets/js/43.04d6c2fc.js"><link rel="prefetch" href="/notes/assets/js/44.3e7a3100.js"><link rel="prefetch" href="/notes/assets/js/45.f9bed2f1.js"><link rel="prefetch" href="/notes/assets/js/46.408d5e96.js"><link rel="prefetch" href="/notes/assets/js/47.42049855.js"><link rel="prefetch" href="/notes/assets/js/48.c07f0eb0.js"><link rel="prefetch" href="/notes/assets/js/49.763dad5f.js"><link rel="prefetch" href="/notes/assets/js/5.19114815.js"><link rel="prefetch" href="/notes/assets/js/50.16466921.js"><link rel="prefetch" href="/notes/assets/js/51.77613262.js"><link rel="prefetch" href="/notes/assets/js/52.371b49d2.js"><link rel="prefetch" href="/notes/assets/js/53.afdfb70b.js"><link rel="prefetch" href="/notes/assets/js/54.0700a309.js"><link rel="prefetch" href="/notes/assets/js/55.f17aa88f.js"><link rel="prefetch" href="/notes/assets/js/56.7ba59c60.js"><link rel="prefetch" href="/notes/assets/js/57.6ab33601.js"><link rel="prefetch" href="/notes/assets/js/58.3df2ea7e.js"><link rel="prefetch" href="/notes/assets/js/59.f05a40b5.js"><link rel="prefetch" href="/notes/assets/js/6.fbd39b4b.js"><link rel="prefetch" href="/notes/assets/js/60.e243c11f.js"><link rel="prefetch" href="/notes/assets/js/61.e56bf6b9.js"><link rel="prefetch" href="/notes/assets/js/62.aade55a7.js"><link rel="prefetch" href="/notes/assets/js/63.14962c3b.js"><link rel="prefetch" href="/notes/assets/js/64.a1883e51.js"><link rel="prefetch" href="/notes/assets/js/65.6c099679.js"><link rel="prefetch" href="/notes/assets/js/66.3e2bb8f1.js"><link rel="prefetch" href="/notes/assets/js/67.0fa3630d.js"><link rel="prefetch" href="/notes/assets/js/68.ed132600.js"><link rel="prefetch" href="/notes/assets/js/69.c7d0f351.js"><link rel="prefetch" href="/notes/assets/js/7.157e2031.js"><link rel="prefetch" href="/notes/assets/js/70.b6f8bbee.js"><link rel="prefetch" href="/notes/assets/js/71.a1072810.js"><link rel="prefetch" href="/notes/assets/js/72.b75efabd.js"><link rel="prefetch" href="/notes/assets/js/73.a670a6c0.js"><link rel="prefetch" href="/notes/assets/js/74.75ac7a5d.js"><link rel="prefetch" href="/notes/assets/js/75.d5442c48.js"><link rel="prefetch" href="/notes/assets/js/76.6ad52012.js"><link rel="prefetch" href="/notes/assets/js/77.ec21c444.js"><link rel="prefetch" href="/notes/assets/js/78.d2379aab.js"><link rel="prefetch" href="/notes/assets/js/79.ac499ef3.js"><link rel="prefetch" href="/notes/assets/js/8.c2e802f8.js"><link rel="prefetch" href="/notes/assets/js/80.deb3a426.js"><link rel="prefetch" href="/notes/assets/js/81.ea9cbddc.js"><link rel="prefetch" href="/notes/assets/js/82.b8544b95.js"><link rel="prefetch" href="/notes/assets/js/83.8c22bdcf.js"><link rel="prefetch" href="/notes/assets/js/84.4895fe5c.js"><link rel="prefetch" href="/notes/assets/js/85.93ab470a.js"><link rel="prefetch" href="/notes/assets/js/86.fd086a14.js"><link rel="prefetch" href="/notes/assets/js/87.7d842136.js"><link rel="prefetch" href="/notes/assets/js/88.d3ad256a.js"><link rel="prefetch" href="/notes/assets/js/89.0fdbabf5.js"><link rel="prefetch" href="/notes/assets/js/9.1e8ef9c9.js"><link rel="prefetch" href="/notes/assets/js/90.c979d5eb.js"><link rel="prefetch" href="/notes/assets/js/91.fffbe9ac.js"><link rel="prefetch" href="/notes/assets/js/92.f46c7ae3.js"><link rel="prefetch" href="/notes/assets/js/93.50976afb.js"><link rel="prefetch" href="/notes/assets/js/94.e9bd725d.js"><link rel="prefetch" href="/notes/assets/js/95.0cf70666.js"><link rel="prefetch" href="/notes/assets/js/96.d5f09b5d.js"><link rel="prefetch" href="/notes/assets/js/97.c2c13071.js"><link rel="prefetch" href="/notes/assets/js/98.b83d8452.js"><link rel="prefetch" href="/notes/assets/js/99.382efddd.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.046e0507.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">还隔这查文档，我上来就是一拳</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/notes/django-content/01-django介绍和相关术语.html" class="nav-link">
  Django
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/vue-content/基础内容/vue初体验.html" class="nav-link">
  基础内容
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/组件化/组件化.html" class="nav-link">
  组件化
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/webpack/安装与基本设置.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/CLI脚手架/CLI安装与项目创建.html" class="nav-link">
  CLI
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Vue-router/前端路由.html" class="nav-link">
  vue-router
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Vuex/介绍.html" class="nav-link">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/axios网络模块/基本使用.html" class="nav-link">
  axios网络模块
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Uni-app/图片choose_preview_uploadFile.html" class="nav-link">
  uni-app
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/常用代码和json文件/头像图片裁剪与上传.html" class="nav-link">
  常用代码和json文件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="css" class="dropdown-title"><span class="title">css</span> <span class="arrow down"></span></button> <button type="button" aria-label="css" class="mobile-dropdown-title"><span class="title">css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/css-content/css基础.html" class="nav-link">
  css基础
</a></li><li class="dropdown-item"><!----> <a href="/notes/css-content/常用网站.html" class="nav-link">
  常用网站
</a></li></ul></div></div><div class="nav-item"><a href="/notes/pieceknowledge/文档碎片操作dom.html" class="nav-link">
  小知识点
</a></div><div class="nav-item"><a href="/notes/diary/20210602.html" class="nav-link">
  日记
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/notes/django-content/01-django介绍和相关术语.html" class="nav-link">
  Django
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/vue-content/基础内容/vue初体验.html" class="nav-link">
  基础内容
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/组件化/组件化.html" class="nav-link">
  组件化
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/webpack/安装与基本设置.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/CLI脚手架/CLI安装与项目创建.html" class="nav-link">
  CLI
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Vue-router/前端路由.html" class="nav-link">
  vue-router
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Vuex/介绍.html" class="nav-link">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/axios网络模块/基本使用.html" class="nav-link">
  axios网络模块
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Uni-app/图片choose_preview_uploadFile.html" class="nav-link">
  uni-app
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/常用代码和json文件/头像图片裁剪与上传.html" class="nav-link">
  常用代码和json文件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="css" class="dropdown-title"><span class="title">css</span> <span class="arrow down"></span></button> <button type="button" aria-label="css" class="mobile-dropdown-title"><span class="title">css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/css-content/css基础.html" class="nav-link">
  css基础
</a></li><li class="dropdown-item"><!----> <a href="/notes/css-content/常用网站.html" class="nav-link">
  常用网站
</a></li></ul></div></div><div class="nav-item"><a href="/notes/pieceknowledge/文档碎片操作dom.html" class="nav-link">
  小知识点
</a></div><div class="nav-item"><a href="/notes/diary/20210602.html" class="nav-link">
  日记
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/notes/vue-content/基础内容/vue初体验/" class="sidebar-heading clickable"><span>Vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/django-content/01-django介绍和相关术语" class="sidebar-heading clickable open"><span>Django</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/django-content/01-django介绍和相关术语.html" class="sidebar-link">django介绍和相关术语</a></li><li><a href="/notes/django-content/02-python虚拟环境.html" class="sidebar-link">python虚拟环境</a></li><li><a href="/notes/django-content/03-项目搭建.html" class="sidebar-link">项目搭建</a></li><li><a href="/notes/django-content/04-django配置.html" class="sidebar-link">django配置</a></li><li><a href="/notes/django-content/05-URLConf调度器.html" class="sidebar-link">URLConf调度器</a></li><li><a href="/notes/django-content/06-模型.html" class="sidebar-link">模型</a></li><li><a href="/notes/django-content/07-视图.html" class="sidebar-link">视图</a></li><li><a href="/notes/django-content/09-admin后台管理.html" class="sidebar-link">admin后台管理</a></li><li><a href="/notes/django-content/10-会话技术.html" class="sidebar-link">会话技术</a></li><li><a href="/notes/django-content/11-分页器.html" class="sidebar-link">分页器</a></li><li><a href="/notes/django-content/12-web请求生命周期分析.html" class="sidebar-link">web请求生命周期分析</a></li><li><a href="/notes/django-content/13-验证码.html" class="sidebar-link">验证码</a></li><li><a href="/notes/django-content/14-中间件.html" class="sidebar-link">中间件</a></li><li><a href="/notes/django-content/15-日志.html" class="sidebar-link">信号signals</a></li><li><a href="/notes/django-content/16-信号signals.html" class="sidebar-link">django的信号signals</a></li><li><a href="/notes/django-content/17-缓存redis.html" class="sidebar-link">缓存redis</a></li><li><a href="/notes/django-content/18-Celery.html" class="sidebar-link">Celery</a></li><li><a href="/notes/django-content/19-DebugToolBar.html" class="sidebar-link">DebugToolBar</a></li><li><a href="/notes/django-content/20-REST framework.html" class="sidebar-link">REST framework</a></li><li><a href="/notes/django-content/21-项目部署.html" class="active sidebar-link">项目部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/django-content/21-项目部署.html#一、项目部署" class="sidebar-link">一、项目部署</a></li></ul></li><li><a href="/notes/django-content/22-文件云存储.html" class="sidebar-link">文件云存储</a></li><li><a href="/notes/django-content/23-富文本DjangoUeditor.html" class="sidebar-link">富文本DjangoUeditor</a></li><li><a href="/notes/django-content/24-文件上传和下载.html" class="sidebar-link">文件上传和下载</a></li><li><a href="/notes/django-content/25-项目开发流程.html" class="sidebar-link">项目开发流程</a></li><li><a href="/notes/django-content/26-邮箱验证和短信验证.html" class="sidebar-link">邮箱验证和短信验证</a></li><li><a href="/notes/django-content/27-模板jinja2引擎.html" class="sidebar-link">模板jinja2引擎</a></li><li><a href="/notes/django-content/28-JWT.html" class="sidebar-link">JWT</a></li><li><a href="/notes/django-content/29-微信小程序登录.html" class="sidebar-link">微信小程序登录</a></li><li><a href="/notes/django-content/30-爬虫.html" class="sidebar-link">爬虫</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/css-content/css基础" class="sidebar-heading clickable"><span>Css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/pieceknowledge/文档碎片操作dom" class="sidebar-heading clickable"><span>小知识点</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/diary/20210602" class="sidebar-heading clickable"><span>diary</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="项目部署"><a href="#项目部署" class="header-anchor">#</a> 项目部署</h1> <h2 id="一、项目部署"><a href="#一、项目部署" class="header-anchor">#</a> 一、项目部署</h2> <p>####1、概述</p> <p>​	项目部署就是将开发完成的Django项目部署到指定的服务器上，而服务器的系统基本都是linux。</p> <p>​	Django项目当前最主要的部署方式是：Python+Django+Nginx+uWSGI</p> <ul><li>python：是python程序运行的环境</li> <li>Django：是项目开发的主要框架，也特指我们开发的django项目</li> <li>Nginx：反向代理服务器，用于实现对用户请求的转发，转发给uWSGI，主要实现3个功能：
<ul><li>反向代理</li> <li>动静分离</li> <li>负载均衡</li></ul></li> <li>uWSGI：python的web服务器，使用WSGI协议和django项目交互，使用uwsgi协议和nginx进行通信</li></ul> <h4 id="_2、环境介绍"><a href="#_2、环境介绍" class="header-anchor">#</a> 2、环境介绍</h4> <p>​	本文中使用的环境为：</p> <ul><li>centos7</li> <li>python3.6.5</li> <li>django2.2</li> <li>nginx1.14.0</li> <li>uWSGI2.0.18</li></ul> <h4 id="_3、安装python"><a href="#_3、安装python" class="header-anchor">#</a> 3、安装python</h4> <p>1、 如果没有安装wget，使用以下命令安装：</p> <div class="language- extra-class"><pre class="language-text"><code>yum -y install wget
</code></pre></div><p>2、 访问 <a href="https://www.python.org/ftp/python/" target="_blank" rel="noopener noreferrer">https://www.python.org/ftp/python/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查找需要下载的python版本，譬如：Python-3.6.5.tgz</p> <p>或者使用window下载后传送到centos中，或者直接使用以下命令下载</p> <div class="language- extra-class"><pre class="language-text"><code>wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz
</code></pre></div><p>​       PS：没有设置下载目录的话，文件会下载在当前目录</p> <p>3、 安装编译器gcc：</p> <div class="language- extra-class"><pre class="language-text"><code>yum install gcc

yum install gcc-c++
</code></pre></div><p>4、 执行解压：</p> <div class="language- extra-class"><pre class="language-text"><code>tar -zxvf Python-3.6.5.tgz
</code></pre></div><p>5、 移动文件夹到指定目录/usr/local/：</p> <div class="language- extra-class"><pre class="language-text"><code>mv Python-3.6.5 /usr/local/
</code></pre></div><p>6、 进入到指定目录：</p> <div class="language- extra-class"><pre class="language-text"><code>cd /usr/local/Python-3.6.5
</code></pre></div><p>7、 修改Setup：</p> <div class="language- extra-class"><pre class="language-text"><code>vi Modules/Setup.dist
</code></pre></div><p>修改结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>## Socket module helper for socket(2)  
_socket socketmodule.c timemodule.c  
  
## Socket module helper for SSL support; you must comment out the other  
## socket line above, and possibly edit the SSL variable:  
##SSL=/usr/local/ssl  
_ssl _ssl.c \  
-DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \  
-L$(SSL)/lib -lssl -lcrypto  

</code></pre></div><p>说明：</p> <p>最下面的3行，本来是被注释的，需要将注释去掉</p> <p>8、 安装zlib依赖包：</p> <div class="language- extra-class"><pre class="language-text"><code>yum install zlib*
</code></pre></div><p>9、 安装sqlite3：</p> <p>直接使用以下命令安装，会安装 sqlite-devel-3.7.17-8.el7.x86_64 版本</p> <div class="language- extra-class"><pre class="language-text"><code>yum install sqlite-devel
</code></pre></div><p>而我们django2.2的版本需要 sqlite3.8.3 或以上版本，因此需要手动安装sqlite3</p> <div class="language- extra-class"><pre class="language-text"><code>## wget 命令安装
## 也可以在windows中下载之后发送到linux中
wget https://www.sqlite.org/2019/sqlite-autoconf-3270200.tar.gz

tar -zxvf sqlite-autoconf-3270200.tar.gz

cd sqlite-autoconf-3270200

## 执行配置
./configure --prefix=/usr/local

## 编译并且安装， 可能会比较耗时
make &amp;&amp; make install

## 查看安装结果
find /usr/ -name sqlite3

## 查看安装版本
/usr/local/bin/sqlite3 --version

## 删除安装包
cd ..
rm sqlite-autoconf-3270200.tar.gz
rm sqlite-autoconf-3270200

## 现有版本
/usr/bin/sqlite3 --version

## 移除现有链接
mv /usr/bin/sqlite3  /usr/bin/sqlite3_old

## 添加新的版本的链接
ln -s /usr/local/bin/sqlite3   /usr/bin/sqlite3

## 将路径传递给共享库, 如果想开机自动运行，则将下面的代码写入到 ~/.bashrc 文件中，文件配置立即生效使用：source ~/.bashrc
export LD_LIBRARY_PATH=&quot;/usr/local/lib&quot;
</code></pre></div><p>10、安装ssl：</p> <div class="language- extra-class"><pre class="language-text"><code>yum install openssl -y
yum install openssl-devel -y

</code></pre></div><p>11、执行配置：</p> <div class="language- extra-class"><pre class="language-text"><code>./configure --prefix=/usr/local/python36 --with-ssl CFLAGS=-fPIC
</code></pre></div><p>12、执行编译：</p> <div class="language- extra-class"><pre class="language-text"><code>make
</code></pre></div><p>PS：会比较耗时</p> <p>13、执行编译安装：</p> <div class="language- extra-class"><pre class="language-text"><code>make install
</code></pre></div><p>PS：会比较耗时</p> <p>14、创建链接：</p> <div class="language- extra-class"><pre class="language-text"><code>ln -s /usr/local/python36/bin/python3.6 /usr/bin/python3

ln -s /usr/local/python36/bin/pip3.6 /usr/bin/pip3
</code></pre></div><p>PS：记住 ln 中的 l 是 L 的小写，不是 i 的大写</p> <p>centos中默认安装有python2.7，在系统中链接为 python2和python</p> <p>我们可以删除现有python2链接：</p> <div class="language- extra-class"><pre class="language-text"><code>rm -rf /usr/bin/python
</code></pre></div><p>然后创建python3.6.5的链接为python</p> <p>但是不推荐，因为很多命令都会依赖python，一旦修改为python3了，会有各种的错误产生</p> <p>15、查看安装结果：</p> <div class="language- extra-class"><pre class="language-text"><code>pip3 -V

python3 -V
</code></pre></div><h4 id="_4、django程序处理"><a href="#_4、django程序处理" class="header-anchor">#</a> 4、Django程序处理</h4> <p>​	假设我们的django项目已经开发完毕</p> <h6 id="_1、通用配置修改"><a href="#_1、通用配置修改" class="header-anchor">#</a> 1、通用配置修改</h6> <p>settings.py：</p> <div class="language-python extra-class"><pre class="language-python"><code>DEBUG <span class="token operator">=</span> <span class="token boolean">False</span>

ALLOWED_HOSTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span>

DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'blog'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'nihaoma0'</span><span class="token punctuation">,</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'192.168.107.107'</span><span class="token punctuation">,</span>
        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token string">'3306'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>说明：</p> <ul><li>修改DEBUG为False，同时必须配置 ALLOWED_HOSTS ，内容是允许访问的域名列表，使用 * 表示通配符</li> <li>修改数据库连接为 生产环境 下使用的</li></ul> <h6 id="_2、静态文件处理"><a href="#_2、静态文件处理" class="header-anchor">#</a> 2、静态文件处理</h6> <p>settings.py：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">## url中访问静态文件的url起始path</span>
STATIC_URL <span class="token operator">=</span> <span class="token string">'/static/'</span>

<span class="token comment">## 合并后的静态文件目录的绝对路径，需要在根目录添加 static 目录</span>
STATIC_ROOT <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'static'</span><span class="token punctuation">)</span>

<span class="token comment">## 以下不是必须的， 扩展的静态文件地址，需要添加 common_static 目录</span>
STATICFILES_DIRS <span class="token operator">=</span> <span class="token punctuation">(</span>
    os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'common_static'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> 

</code></pre></div><p>说明：</p> <ul><li>主要需要添加 STATIC_ROOT 配置，用于部署后，合并各个子应用下的静态文件</li> <li>部署后，别忘记使用 <code>python manage.py collectstatic</code>命令，合并各个子应用下的静态文件，然后在 处理静态文件的服务器中（如nginx）配置到该路径</li></ul> <h6 id="_3、python环境处理"><a href="#_3、python环境处理" class="header-anchor">#</a> 3、python环境处理</h6> <p>在django项目的根目录，生成一个 requirements.txt</p> <div class="language- extra-class"><pre class="language-text"><code>## 如果使用的第三方库比较少，那么可以手写一个 requirements.txt
## 如果使用的第三方库较多，那么就使用以下命令：
pip freeze &gt; requirements.txt

## 拷贝上述的文件到服务器中，并且执行以下命令安装环境
pip3 install -r requirements.txt

</code></pre></div><h6 id="_4、复制项目文件到服务器"><a href="#_4、复制项目文件到服务器" class="header-anchor">#</a> 4、复制项目文件到服务器</h6> <p>将项目拷贝linux系统中（譬如FTP），然后移动到 /var/www/ 目录下</p> <div class="language- extra-class"><pre class="language-text"><code>mv /ftp/childrenshop /var/www/
</code></pre></div><p>PS：拷贝完成后，记得执行合并static的命令<code>python manage.py collectstatic</code></p> <h4 id="_5、安装和使用uwsgi"><a href="#_5、安装和使用uwsgi" class="header-anchor">#</a> 5、安装和使用uWSGI</h4> <p>1、 uwsgi官方文档：http://uwsgi-docs.readthedocs.io/en/latest/tutorials/Django_and_nginx.html</p> <p>2、 在生产环境中，使用虚拟环境，一般我们的linux中，会有2套 python，一个是系统自带的python2，一个是我们的项目环境所需的python3</p> <div class="language- extra-class"><pre class="language-text"><code>##使用以下命令查看
python2 -V
python3 -V 

</code></pre></div><p>3、 在环境中安装项目所需第三方库，假定当前djang项目（项目名：childrenshop）已经拷贝到 /var/www 目录下，并且目录中已经有  requirements.txt 文件</p> <div class="language- extra-class"><pre class="language-text"><code>## 切换到 项目路径
cd /var/www/children

## 安装环境
pip3 install -r requirements.txt -i http://pypi.douban.com/simple --trusted-host pypi.douban.com

</code></pre></div><p>4、 使用 pip 安装uwsgi</p> <div class="language- extra-class"><pre class="language-text"><code>pip3 install uwsgi==2.0.18 -i http://pypi.douban.com/simple --trusted-host pypi.douban.com
</code></pre></div><p>说明：</p> <ul><li>-i ： 指定镜像源的网址，这里使用的豆瓣</li> <li>--trusted-host ： 信任 -i 指定的网站，不进行信任的话，会出现SSL错误</li></ul> <p>5、 测试uwsgi</p> <p>编写一个测试的py文件</p> <div class="language- extra-class"><pre class="language-text"><code>vi test.py
</code></pre></div><p>​       文件内容如下：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">##!/usr/bin/env python3</span>
<span class="token comment">## coding:utf-8</span>

<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">application</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span>start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    start_response<span class="token punctuation">(</span><span class="token string">'200 OK'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'Welcome to use uwsgi!!!'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><p>​       运行：</p> <div class="language- extra-class"><pre class="language-text"><code>/usr/local/python36/bin/uwsgi --http 0.0.0.0:8997 --wsgi-f /var/www/childrenshop/	test.py
这里的路径应修改为实际情况
</code></pre></div><p>注意：</p> <p>由于我们需要从本机访问linux的8997端口，因此需要设置linux的防火墙：</p> <div class="language- extra-class"><pre class="language-text"><code>centos 》 7.0
## 开放8997端口
firewall-cmd --zone=public --add-port=8997/tcp --permanent

## 删除端口
firewall-cmd --zone=public --remove-port=8997/tcp

## 重启防火墙
firewall-cmd --reload

## 查看防火墙状态
firewall-cmd --list-all

centos &lt; 7.0
vi /etc/sysconfig/iptables
添加语句
-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT
其中8080就是新增端口号

## 重启防火墙
service iptables restart

## 关闭、开启防火墙
service iptables stop/start
</code></pre></div><p>​</p> <p>在浏览器中，访问： http://192.168.134.101:8997    ，注意修改对应的ip地址</p> <p>​       即可查看到类似如下页面中显示：</p> <div class="language- extra-class"><pre class="language-text"><code>Welcome to use uwsgi!!!
</code></pre></div><p>9、 使用 uwsgi 启动django：</p> <p>使用 ini格式配置文件，文件名 uwsgi.ini ：</p> <div class="language- extra-class"><pre class="language-text"><code>vi uwsgi.ini
</code></pre></div><p>文件内容：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[uwsgi]</span>
<span class="token comment">## 虚拟主机模式</span>
<span class="token constant">vhost</span> <span class="token attr-value"><span class="token punctuation">=</span> false  </span>
<span class="token comment">## ip端口如果存在nginx应该为socket，否则为http不能占用nginx的端口否则会出错</span>
<span class="token constant">socket</span> <span class="token attr-value"><span class="token punctuation">=</span> 0.0.0.0:8000	</span>

<span class="token comment">## 是否主服务器</span>
<span class="token constant">master</span> <span class="token attr-value"><span class="token punctuation">=</span> true</span>
<span class="token comment">## 是否多线程</span>
<span class="token constant">enable-threads</span> <span class="token attr-value"><span class="token punctuation">=</span> true</span>
<span class="token comment">## 工作进程数</span>
<span class="token constant">workers</span> <span class="token attr-value"><span class="token punctuation">=</span> 5</span>
<span class="token comment">## wsgi.py文件的位置而非uwsgi启动程序文件</span>
<span class="token constant">wsgi-file</span> <span class="token attr-value"><span class="token punctuation">=</span> /usr/var/my_env/blog/blog/wsgi.py</span>
<span class="token comment">## 项目的根目录</span>
<span class="token constant">chdir</span> <span class="token attr-value"><span class="token punctuation">=</span> /usr/var/my_env/blog/</span>

<span class="token comment">## 设置 pid 记录文件</span>
<span class="token constant">pidfile</span> <span class="token attr-value"><span class="token punctuation">=</span> /usr/var/my_env/blog/uwsgi.pid</span>
<span class="token comment">## 后台运行uwsgi, 如果想实时查看日志内容，可以使用 tail -f uwsgi.log</span>
<span class="token constant">daemonize</span> <span class="token attr-value"><span class="token punctuation">=</span> /usr/var/my_env/blog/uwsgilogs/uwsgi.log</span>

<span class="token comment">## 由于python版本而出现的no python application错误时写入</span>
<span class="token comment">## pythonpath = /usr/var/my_env/blog/lib/python3.6/site-packages</span>
</code></pre></div><p>说明：</p> <ul><li><p>daemonize 指定 log 输出， 需要创建对应的 目录</p></li> <li><p>如果是想要通过浏览器访问的话，需要将配置中的 socket =  修改为 http = ，否则会报以下错误：</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>invalid request block size: 21573 (max 4096)...skip  
</code></pre></div><p>同时需要在防火墙中开放 8997 端口，如果上面已经开放过了，就不需要再额外处理</p> <p>若出现以下错误：</p> <div class="language- extra-class"><pre class="language-text"><code>no python application found, check your startup logs for errors
</code></pre></div><ul><li><p>wsgi-file文件填写错误</p></li> <li><p>python编译器版本错误（本应3.*却调用了2.*版本）</p></li> <li><p>wsgi.py文件需要注册虚拟环境的site-packages</p> <p>wsgi.py文件代码应如下所示：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">## wsgi.py file begin </span>
<span class="token keyword">import</span> os<span class="token punctuation">,</span> sys
<span class="token comment">## add the hellodjango project path into the sys.path</span>
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'&lt;PATH_TO_MY_DJANGO_PROJECT&gt;/hellodjango'</span><span class="token punctuation">)</span>  <span class="token comment">## 添加你的项目绝对路径</span>
<span class="token comment">## sys.path.append('...../my_env/blog')填入项目根目录的绝对路径</span>


<span class="token comment">## add the virtualenv site-packages path to the sys.path</span>
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'&lt;PATH_TO_VIRTUALENV&gt;/Lib/site-packages'</span><span class="token punctuation">)</span>  <span class="token comment">## 添加你虚拟环境包绝对路径</span>
<span class="token comment">## sys.path.append('...../my_env/blog/lib/python3.*/site-packages')填入项目lib下的python3.*的site-packages路径</span>


<span class="token comment">## poiting to the project settings</span>
os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hellodjango.settings&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>wsgi <span class="token keyword">import</span> get_wsgi_application

application <span class="token operator">=</span> get_wsgi_application<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">## wsgi.py file end</span>
</code></pre></div></li></ul> <p>启动 uwsgi：</p> <div class="language- extra-class"><pre class="language-text"><code>/usr/local/python36/bin/uwsgi --ini /var/www/childrenshop/uwsgi.ini
</code></pre></div><p>也可以先创建链接，再运行：</p> <div class="language- extra-class"><pre class="language-text"><code>ln /usr/local/python36/bin/uwsgi /usr/bin/uwsgi

uwsgi --ini /var/www/childrenshop/uwsgi.ini
</code></pre></div><p>如果不以后台模式启动，会得到如下界面：</p> <p>备注：</p> <p>如果需要使用 killall 命令关闭所有的uwsgi进程的话，需要安装库：</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y psmisc
</code></pre></div><p>安装完毕后，可以使用以下命令关闭 uwsgi 进程</p> <div class="language- extra-class"><pre class="language-text"><code>killall -9 uwsgi
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>tail -f uwsgi.ini ##可以监听uwsgi进程
</code></pre></div><p>10、设置启动脚本，service方式（7.0版本）</p> <p>在/etc/init.d/  目录下建立3个脚本：</p> <p>uwsgi-start.sh</p> <div class="language- extra-class"><pre class="language-text"><code>##!/bin/bash -e

export LD_LIBRARY_PATH=&quot;/usr/local/lib&quot;

/usr/local/python36/bin/uwsgi --ini /var/www/childrenshop/uwsgi.ini
</code></pre></div><p>说明： export LD_LIBRARY_PATH=&quot;/usr/local/lib&quot;   这一行是为了防止 出现 sqlite 版本错误</p> <p>uwsgi-stop.sh</p> <div class="language- extra-class"><pre class="language-text"><code>##!/bin/bash -e

/usr/local/python36/bin/uwsgi --stop /var/run/uwsgi.pid

</code></pre></div><p>说明：/var/run/uwsgi.pid 是在 uwsgi.ini 中配置的</p> <p>uwsgi-restart.sh</p> <div class="language- extra-class"><pre class="language-text"><code>##!/bin/bash -e

/usr/local/python36/bin/uwsgi --reload /var/run/uwsgi.pid
</code></pre></div><p>脚本赋予权限：</p> <div class="language- extra-class"><pre class="language-text"><code>chmod 755 uwsgi-start.sh
chmod 755 uwsgi-stop.sh
chmod 755 uwsgi-restart.sh
</code></pre></div><p>编写service脚本：</p> <div class="language- extra-class"><pre class="language-text"><code>vi /usr/lib/systemd/system/uwsgi.service

</code></pre></div><p>填入以下内容：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[Unit]</span>
<span class="token constant">Description</span><span class="token attr-value"><span class="token punctuation">=</span>uwsgi</span>
<span class="token constant">After</span><span class="token attr-value"><span class="token punctuation">=</span>network.target</span>
   
<span class="token selector">[Service]</span>
<span class="token constant">Type</span><span class="token attr-value"><span class="token punctuation">=</span>forking</span>
<span class="token constant">PIDFile</span><span class="token attr-value"><span class="token punctuation">=</span>/var/run/uwsgi.pid</span>
<span class="token constant">ExecStart</span><span class="token attr-value"><span class="token punctuation">=</span>/etc/init.d/uwsgi-start.sh</span>
<span class="token constant">ExecReload</span><span class="token attr-value"><span class="token punctuation">=</span>/etc/init.d/uwsgi-restart.sh</span>
<span class="token constant">ExecStop</span><span class="token attr-value"><span class="token punctuation">=</span>/etc/init.d/uwsgi-stop.sh</span>
<span class="token constant">PrivateTmp</span><span class="token attr-value"><span class="token punctuation">=</span>true</span>
   
<span class="token selector">[Install]</span>
<span class="token constant">WantedBy</span><span class="token attr-value"><span class="token punctuation">=</span>multi-user.target</span>
</code></pre></div><p>说明：</p> <ul><li><p>以上出现的路径必须是绝对路径</p></li> <li><p>ExecStart、ExecReload、ExecStop 3个分别对应 启动、重新启动、停止</p></li> <li><p>PIDFile 对应启动后的 pid 保存文件</p></li></ul> <p>设置自启动</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl enable uwsgi.service
</code></pre></div><p>说明： .service  可以省略</p> <div class="language- extra-class"><pre class="language-text"><code>## 启动
systemctl start uwsgi

## 停止
systemctl stop uwsgi

## 重启
systemctl restart uwsgi
</code></pre></div><p>10.1 systemctl是centos7.0版本代替centos6.*版本的service 和 chkconfig的</p> <p>通过service 和 chkconfig设置自启动和系统脚本</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">## 直接执行脚本</span>
/etc/init.d/netword restart
<span class="token comment">## 通过 service 命令执行脚本</span>
<span class="token function">service</span> network restart
</code></pre></div><p>service 等同于netword</p> <p>在/etc/init.d/下创建自定义脚本文件：my-uwsgi</p> <div class="language- extra-class"><pre class="language-text"><code>vi /etc/init.d/my-uwsgi
</code></pre></div><p>在my-uwsgi写入</p> <div class="language- extra-class"><pre class="language-text"><code>##!/bin/bash
##chkconfig:35 85 15
DAEMON=/usr/local/python3/bin/uwsgi
case &quot;$1&quot; in
start)
  echo &quot;Starting uwsgi daemon...&quot;
  export LD_LIBRARY_PATH=&quot;/usr/lib&quot;
  $DAEMON --ini /usr/var/my_env/releaseVol1/uwsgi.ini &amp;&amp; echo &quot;SUCCESS&quot;
  ;;  
stop)
  echo &quot;Stopping uwsgi deamon...&quot;
  $DAEMON --stop /usr/var/my_env/releaseVol1/uwsgi.pid &amp;&amp; echo &quot;SUCCESS&quot;
  ;;  
restart)
  echo &quot;Restarting uwsgi deamon&quot;
  $DAEMON --reload /usr/var/my_env/releaseVol1/uwsgi.pid &amp;&amp; echo &quot;SUCCESS&quot;
  ;;  
*)
  echo &quot;Usage:service nginx{start|stop|reload|restart}&quot;
  exit 2
  ;;  
esac
</code></pre></div><p>其中uwsgi.pid和uwsgi.ini都是绝对路径， ##chkconfig:35 85 15设定了开机自启动配置</p> <p>也可以通过指令chkconfig操作</p> <div class="language- extra-class"><pre class="language-text"><code>## 添加自启动指令
chkconfig --add my-uwsgi
## 删除自启动指令
chkconfig --del my-uwsgi
## 查看开机自启动列表
chkconfig --list
</code></pre></div><p>最后给my-uwsgi添加权限</p> <div class="language- extra-class"><pre class="language-text"><code>chmod 755 my-uwsgi
</code></pre></div><h4 id="_6、安装和使用nginx"><a href="#_6、安装和使用nginx" class="header-anchor">#</a> 6、安装和使用nginx</h4> <h6 id="_1-配置说明"><a href="#_1-配置说明" class="header-anchor">#</a> 1.配置说明</h6> <p>​	Nginx服务器的配置信息主要集中在&quot;nginx.conf&quot;这个配置文件中（默认为/usr/local/nginx/conf/nginx.conf），所有的可配置项主要为以下几点：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>main                                <span class="token comment">## 全局配置</span>

<span class="token keyword">events</span> <span class="token punctuation">{</span>                            <span class="token comment">## 工作模式配置</span>

<span class="token punctuation">}</span>

<span class="token keyword">http</span> <span class="token punctuation">{</span>                              <span class="token comment">## http设置</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">server</span> <span class="token punctuation">{</span>                        <span class="token comment">## 服务器主机配置（虚拟主机、反向代理等）</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">location</span> \ <span class="token punctuation">{</span>                  <span class="token comment">## 路由配置（虚拟目录等）</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">location</span> path <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">location</span> otherpath <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token keyword">location</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">upstream</span> name <span class="token punctuation">{</span>                  <span class="token comment">## 负载均衡配置</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>各模块中主要的配置为：</p> <p>######## 1.main模块</p> <ul><li>user：用来指定nginx worker进程运行用户以及用户组，默认nobody账号运行</li> <li>worker_processes：指定nginx要开启的子进程数量，运行过程中监控每个进程消耗内存(一般几M~几十M不等)根据实际情况进行调整，通常数量是CPU内核数量的整数倍</li> <li>error_log：定义错误日志文件的位置及输出级别【debug / info / notice / warn / error / crit】</li> <li>pid：用来指定进程id的存储文件的位置</li> <li>worker_rlimit_nofile：用于指定一个进程可以打开最多文件数量的描述</li></ul> <p>######## 2.event模块</p> <ul><li><p>worker_connections：指定最大可以同时接收的连接数量，这里一定要注意，最大连接数量是和worker_processes共同决定的，理论上是worker_processes*worker_connections</p></li> <li><p>multi_accept：配置指定nginx在收到一个新连接通知后尽可能多的接受更多的连接</p></li> <li><p>use epoll：配置指定了线程轮询的方法，如果是linux2.6+，使用epoll，如果是BSD如Mac请使用Kqueue</p></li></ul> <p>######## 3.http模块</p> <p>作为web服务器，http模块是nginx最核心的一个模块，配置项也是比较多的，项目中会设置到很多的实际业务场景，需要根据硬件信息进行适当的配置。</p> <p>########## 1.基础配置</p> <ul><li>sendfile on：配置on让sendfile发挥作用，将文件的回写过程交给数据缓冲去完成，而不是放在应用中完成，这样的话在性能提升有有好处</li> <li>tcp_nopush on：让nginx在一个数据包中发送所有的头文件，而不是一个一个单独发</li> <li>tcp_nodelay on：让nginx不要缓存数据，而是一段一段发送，如果数据的传输有实时性的要求的话可以配置它，发送完一小段数据就立刻能得到返回值，但是不要滥用哦</li> <li>keepalive_timeout 10：给客户端分配连接超时时间，服务器会在这个时间过后关闭连接。一般设置时间较短，可以让nginx工作持续性更好</li> <li>client_header_timeout 10：设置请求头的超时时间</li> <li>client_body_timeout 10:设置请求体的超时时间</li> <li>send_timeout 10：指定客户端响应超时时间，如果客户端两次操作间隔超过这个时间，服务器就会关闭这个连接</li> <li>limit_conn_zone $binary_remote_addr zone=addr:5m ：设置用于保存各种key的共享内存的参数，</li> <li>limit_conn addr 100: 给定的key设置最大连接数</li> <li>server_tokens：虽然不会让nginx执行速度更快，但是可以在错误页面关闭nginx版本提示，对于网站安全性的提升有好处哦</li> <li>include /etc/nginx/mime.types：指定在当前文件中包含另一个文件的指令</li> <li>default_type application/octet-stream：指定默认处理的文件类型可以是二进制</li> <li>type_hash_max_size 2048：混淆数据，影响三列冲突率，值越大消耗内存越多，散列key冲突率会降低，检索速度更快；值越小key，占用内存较少，冲突率越高，检索速度变慢</li></ul> <p>########## 2.日志配置</p> <ul><li><p>access_log logs/access.log：设置存储访问记录的日志</p></li> <li><p>error_log logs/error.log：设置存储记录错误发生的日志</p></li></ul> <p>########## 3.SSL证书配置</p> <ul><li><p>ssl_protocols：指令用于启动特定的加密协议，nginx在1.1.13和1.0.12版本后默认是ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2，TLSv1.1与TLSv1.2要确保OpenSSL &gt;= 1.0.1 ，SSLv3 现在还有很多地方在用但有不少被攻击的漏洞。</p></li> <li><p>ssl prefer server ciphers：设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件</p></li></ul> <p>########## 4.压缩配置</p> <ul><li>gzip 是告诉nginx采用gzip压缩的形式发送数据。这将会减少我们发送的数据量。</li> <li>gzip_disable 为指定的客户端禁用gzip功能。我们设置成IE6或者更低版本以使我们的方案能够广泛兼容。</li> <li>gzip_static 告诉nginx在压缩资源之前，先查找是否有预先gzip处理过的资源。这要求你预先压缩你的文件，从而允许你使用最高压缩比，这样nginx就不用再压缩这些文件了</li> <li>gzip_proxied 允许或者禁止压缩基于请求和响应的响应流。我们设置为any，意味着将会压缩所有的请求。</li> <li>gzip_min_length 设置对数据启用压缩的最少字节数。如果一个请求小于1000字节，我们最好不要压缩它，因为压缩这些小的数据会降低处理此请求的所有进程的速度。</li> <li>gzip_comp_level 设置数据的压缩等级。这个等级可以是1-9之间的任意数值，9是最慢但是压缩比最大的。我们设置为4，这是一个比较折中的设置。</li> <li>gzip_type 设置需要压缩的数据格式</li></ul> <p>########## 5.文件缓存配置</p> <ul><li>open_file_cache 打开缓存的同时也指定了缓存最大数目，以及缓存的时间。我们可以设置一个相对高的最大时间，这样我们可以在它们不活动超过20秒后清除掉。</li> <li>open_file_cache_valid 在open_file_cache中指定检测正确信息的间隔时间。</li> <li>open_file_cache_min_uses 定义了open_file_cache中指令参数不活动时间期间里最小的文件数。</li> <li>open_file_cache_errors 指定了当搜索一个文件时是否缓存错误信息，也包括再次给配置中添加文件。我们也包括了服务器模块，这些是在不同文件中定义的。如果你的服务器模块不在这些位置，你就得修改这一行来指定正确的位置。</li></ul> <p>########## 6.server模块</p> <p>​	server模块配置是http模块中的一个子模块，用来定义一个虚拟访问主机，也就是一个虚拟服务器的配置信息。</p> <p>​	类似：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">http</span> <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span>         <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>    localhost <span class="token number">192.168</span><span class="token number">.134</span><span class="token number">.130</span><span class="token punctuation">;</span>
        <span class="token keyword">charset</span>        utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token keyword">access_log</span>     logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
        <span class="token keyword">error_log</span>      logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <ul><li>server：一个虚拟主机的配置，一个http中可以配置多个server</li> <li>server_name：用来指定ip地址或者域名，多个配置之间用空格分隔</li> <li>charset：用于设置www/路径中配置的网页的默认编码格式</li> <li>access_log：用于指定该虚拟主机服务器中的访问记录日志存放路径</li> <li>error_log：用于指定该虚拟主机服务器中访问错误日志的存放路径</li></ul> <p>########## 7.location模块</p> <p>​	location模块是Nginx配置中出现最多的一个配置，主要用于配置路由访问信息，属于http下的server下的子模块。</p> <p>​	在路由访问信息配置中关联到反向代理、负载均衡等等各项功能，所以location模块也是一个非常重要的配置模块。</p> <ol><li>基本配置</li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">http</span> <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">root</span>    <span class="token operator">/</span>nginx<span class="token operator">/</span>www<span class="token punctuation">;</span>
            <span class="token keyword">index</span>    <span class="token keyword">index</span><span class="token punctuation">.</span>php <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <ul><li><p>location /：表示匹配访问根目录</p></li> <li><p>root：用于指定访问根目录时，访问虚拟主机的web目录</p></li> <li><p>index：在不指定访问具体资源时，默认展示的资源文件列表</p></li></ul> <ol start="2"><li>反向代理配置</li></ol> <p>通过反向代理代理服务器访问模式，通过代理配置让客户端访问透明化。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8888</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> <span class="token string">'X-real-ip $remote_addr'</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <ul><li><p>location / :  其中的 / 指明是url根路径</p></li> <li><p>proxy_pass：代理的目标，ip和端口</p></li> <li><p>proxy_set_header：代理后，添加的header</p></li></ul> <ol start="3"><li>uWSGI配置</li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">include</span> uwsgi_params<span class="token punctuation">;</span>
    uwsgi_pass localhost<span class="token punctuation">:</span><span class="token number">8888</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <ul><li>include： 指定uwsgi的配置参数</li> <li>uwsgi_pass：uWSGI服务器的IP和端口</li></ul> <ol start="4"><li>静态文件</li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span>static<span class="token operator">/</span> <span class="token punctuation">{</span>
	<span class="token keyword">alias</span> <span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>test_project<span class="token operator">/</span>static<span class="token operator">/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <ul><li>/static/： url的起始path</li> <li>alias： 指定服务器的静态文件目录</li></ul> <p>########## 8.负载均衡模块（upstream）</p> <p>upstream模块主要负责负载均衡的配置，通过默认的轮询调度方式来分发请求到后端服务器。简单的配置方式如下。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> name <span class="token punctuation">{</span>
    <span class="token comment">##ip_hash;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.101</span><span class="token punctuation">:</span><span class="token number">8000</span> weight<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.102</span><span class="token punctuation">:</span><span class="token number">8001</span> down<span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.103</span><span class="token punctuation">:</span><span class="token number">8002</span> max_fails<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.104</span><span class="token punctuation">:</span><span class="token number">8003</span> fail_timeout<span class="token operator">=</span><span class="token number">20</span>s<span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.105</span><span class="token punctuation">:</span><span class="token number">8004</span> max_fails<span class="token operator">=</span><span class="token number">3</span> fail_timeout<span class="token operator">=</span><span class="token number">20</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <ul><li><p>ip_hash：指定请求调度算法，默认是weight权重轮询调度，可以指定</p> <ul><li><p>默认没有配置时，采取轮询，配合weight，譬如配置如下：</p> <div class="language- extra-class"><pre class="language-text"><code>upstream name {
    server 192.168.1.101:8000;
    server 192.168.1.102:8001 weight=2;
}
</code></pre></div><p>那么用户发送请求时，会执行执行这样的逻辑： 8000端口一次， 8001端口两次。。。循环</p></li> <li><p>ip_hash：根据客户端ip的hash值决定服务器，这样每个ip的客户端固定访问一个服务器</p></li> <li><p>least_conn：请求将被分配到活动连接数量最少的服务器</p></li> <li><p>fair：按后端服务器的响应时间来请求分配，响应时间短的优先分配</p></li> <li><p>url_hash：按访问url的hash结果来分配请求，按每个url定向到同一个后端服务器，后端服务器为缓存时比较有效</p></li></ul></li> <li><p>server host:port：分发服务器的列表配置</p></li> <li><p>down：表示该主机暂停服务</p></li> <li><p>max_fails：表示失败最大次数，超过失败最大次数暂停服务</p></li> <li><p>fail_timeout：表示如果请求受理失败，暂停指定的时间之后重新发起请求</p></li></ul> <h6 id="_2-安装"><a href="#_2-安装" class="header-anchor">#</a> 2.安装</h6> <p>1、 gcc 安装</p> <div class="language- extra-class"><pre class="language-text"><code>yum install gcc-c++
</code></pre></div><p>2、 PCRE pcre-devel 安装</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y pcre pcre-devel
</code></pre></div><p>3、 zlib 安装</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y zlib zlib-devel
</code></pre></div><p>4、 openssl 安装</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y openssl openssl-devel
</code></pre></div><p>5、 安装nginx， 官网地址：<a href="https://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">https://nginx.org/en/download.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>可以手动去官网下载对应的版本，然后拷贝到linux系统中</p> <p>也可以使用 wget 下载</p> <div class="language- extra-class"><pre class="language-text"><code>wget -c https://nginx.org/download/nginx-1.14.0.tar.gz
</code></pre></div><p>6、 下载完成后，进行解压：</p> <div class="language- extra-class"><pre class="language-text"><code>tar -zxvf nginx-1.14.0.tar.gz
</code></pre></div><p>7、 进入解压后的目录</p> <div class="language- extra-class"><pre class="language-text"><code>cd nginx-1.14.0
</code></pre></div><p>8、 应用默认配置，执行</p> <div class="language- extra-class"><pre class="language-text"><code>## 默认安装
./configure

## 指定一些特定参数的安装
./configure --with-http_ssl_module --prefix=&quot;/install/program/nginx&quot; --with-http_stub_status_module
</code></pre></div><p>9、 执行编译：</p> <div class="language- extra-class"><pre class="language-text"><code>make
</code></pre></div><p>10、执行安装：</p> <div class="language- extra-class"><pre class="language-text"><code>make install
</code></pre></div><p>11、查看安装路径：</p> <div class="language- extra-class"><pre class="language-text"><code>whereis nginx
</code></pre></div><p>路径默认在： /usr/local/nginx</p> <p>12、常用命令：</p> <div class="language- extra-class"><pre class="language-text"><code>## 首先进行nginx安装目录下的 sbin 目录
cd /usr/local/nginx/sbin

## 启动nginx
./nginx

## 停止nginx：
## 此方式停止步骤是待nginx进程处理任务完毕进行停止，推荐这个
./nginx -s quit

## 此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程
./nginx -s stop

## 查看nginx进程
ps aux|grep nginx

## 验证配置文件：
./nginx -t

## 修改了nginx的配置文件，如果需要重新加载配置文件，使用：
./nginx -s reload

</code></pre></div><p>13、启动nginx后，可以查看端口监听情况</p> <div class="language- extra-class"><pre class="language-text"><code>netstat -tlnp
</code></pre></div><p>14、关闭linux防火墙或者开放nginx的端口，在浏览器中访问，即可查看到对应的欢迎页面</p> <p>15、设置nginx为开机启动</p> <ul><li>简单方式：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>## 编辑文件：
vi /etc/rc.local

## 增加一行 
/usr/local/nginx/sbin/nginx

## 设置权限
chmod 755 /etc/rc.local
</code></pre></div><ul><li>service方式：</li></ul> <p>编写service脚本：</p> <div class="language- extra-class"><pre class="language-text"><code>vi /usr/lib/systemd/system/nginx.service
</code></pre></div><p>填入以下内容：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[Unit]</span>
<span class="token constant">Description</span><span class="token attr-value"><span class="token punctuation">=</span>nginx</span>
<span class="token constant">After</span><span class="token attr-value"><span class="token punctuation">=</span>network.target</span>
   
<span class="token selector">[Service]</span>
<span class="token constant">Type</span><span class="token attr-value"><span class="token punctuation">=</span>forking</span>
<span class="token constant">PIDFile</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/local/nginx/logs/nginx.pid</span>
<span class="token constant">ExecStart</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/local/nginx/sbin/nginx</span>
<span class="token constant">ExecReload</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/local/nginx/sbin/nginx -s reload</span>
<span class="token constant">ExecStop</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/local/nginx/sbin/nginx -s quit</span>
<span class="token constant">PrivateTmp</span><span class="token attr-value"><span class="token punctuation">=</span>true</span>
   
<span class="token selector">[Install]</span>
<span class="token constant">WantedBy</span><span class="token attr-value"><span class="token punctuation">=</span>multi-user.target</span>
</code></pre></div><p>说明：</p> <ul><li>以上出现的路径必须是绝对路径</li> <li>ExecStart、ExecReload、ExecStop 3个分别对应 启动、重新启动、停止</li> <li>PIDFile 对应启动后的 pid 保存文件</li></ul> <p>设置自启动</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl enable nginx.service
</code></pre></div><p>说明： .service可以省略</p> <h6 id="_3-配置项目"><a href="#_3-配置项目" class="header-anchor">#</a> 3.配置项目</h6> <p>1、nginx配置</p> <p>配置文件位置：在 /usr/local/nginx/conf/nginx.conf</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment">###################### 每个指令必须有分号结束。##################################</span>
<span class="token comment">## 配置用户或者组，默认为nobody nobody。</span>
<span class="token comment">## user administrator administrators;  </span>
<span class="token comment">##允许生成的进程数，默认为1</span>
<span class="token comment">## worker_processes 2;  </span>
<span class="token comment">## 指定nginx进程运行文件存放地址</span>
<span class="token keyword">pid</span> <span class="token operator">/</span>nginx<span class="token operator">/</span>nginx<span class="token punctuation">.</span><span class="token keyword">pid</span><span class="token punctuation">;</span>  
<span class="token comment">##制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别依次为：debug|info|notice|warn|error|crit</span>
<span class="token keyword">error_log</span> logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log debug<span class="token punctuation">;</span>  
<span class="token keyword">events</span> <span class="token punctuation">{</span>
	<span class="token comment">##设置网路连接序列化，防止惊群现象发生，默认为on</span>
    <span class="token keyword">accept_mutex</span> on<span class="token punctuation">;</span>   
    <span class="token comment">##设置一个进程是否同时接受多个网络连接，默认为off</span>
    <span class="token keyword">multi_accept</span> on<span class="token punctuation">;</span> 
    <span class="token comment">##事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span>
    <span class="token comment">##use epoll;    </span>
    <span class="token comment">##最大连接数，默认为 1024</span>
    <span class="token keyword">worker_connections</span>  <span class="token number">1024</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
<span class="token keyword">http</span> <span class="token punctuation">{</span>
	<span class="token comment">##文件扩展名与文件类型映射表</span>
    <span class="token keyword">include</span>       mime<span class="token punctuation">.</span><span class="token keyword">types</span><span class="token punctuation">;</span>   
    <span class="token comment">##默认文件类型，默认为text/plain</span>
    <span class="token keyword">default_type</span>  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span> 
    <span class="token comment">## 取消服务日志   </span>
    <span class="token comment">##access_log off;  </span>
    <span class="token comment">##自定义格式</span>
    <span class="token keyword">log_format</span> myFormat <span class="token string">'$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'</span><span class="token punctuation">;</span> 
    <span class="token comment">##combined为日志格式的默认值</span>
    <span class="token keyword">access_log</span> logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log myFormat<span class="token punctuation">;</span>  
    <span class="token comment">##允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。</span>
    <span class="token keyword">sendfile</span> on<span class="token punctuation">;</span>   
    <span class="token comment">##每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span>
    <span class="token keyword">sendfile_max_chunk</span> <span class="token number">100</span>k<span class="token punctuation">;</span>  
    <span class="token comment">##连接超时时间，默认为75秒，可以在http，server，location块设置。</span>
    <span class="token keyword">keepalive_timeout</span> <span class="token number">65</span><span class="token punctuation">;</span>  

    <span class="token keyword">server</span> <span class="token punctuation">{</span>
    	<span class="token comment">## 端口</span>
        <span class="token keyword">listen</span>    <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token comment">## 虚拟主机名，发布到互联网上写 域名，如:  *.test.com</span>
        <span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span>    
        <span class="token comment">## 默认编码</span>
        <span class="token keyword">charset</span> utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>   
        <span class="token comment">## 路径</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            	<span class="token comment">## 开启对http1.1支持</span>
            	<span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
                <span class="token comment">## 设置Connection为空串, 以禁止传递头部到后端</span>
                <span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>        
        		<span class="token comment">## 包含 uwsgi配置，这个是相对路径，也可以使用绝对路径</span>
                <span class="token keyword">include</span> uwsgi_params<span class="token punctuation">;</span>    
                <span class="token comment">## uwsgi的端口</span>
                uwsgi_pass <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8998</span><span class="token punctuation">;</span>     
                <span class="token comment">## 指定连接到后端uWSGI的超时时间。</span>
                uwsgi_send_timeout <span class="token number">60</span><span class="token punctuation">;</span>  
                <span class="token comment">## 指定向uWSGI传送请求的超时时间，完成握手后向uWSGI传送请求的超时时间。</span>
                uwsgi_connect_timeout <span class="token number">60</span><span class="token punctuation">;</span>  
                <span class="token comment">## 指定接收uWSGI应答的超时时间，完成握手后接收uWSGI应答的超时时间。</span>
                uwsgi_read_timeout <span class="token number">60</span><span class="token punctuation">;</span>        
        <span class="token punctuation">}</span>
		
		<span class="token comment">## 静态文件，和django项目中的settings中配置的 STATIC_URL = '/static/' 相对应</span>
        <span class="token keyword">location</span> <span class="token operator">/</span>static<span class="token operator">/</span> <span class="token punctuation">{</span>
            	<span class="token comment">## 执行 collectstatic 合并静态文件之后的目录</span>
                <span class="token keyword">alias</span> <span class="token operator">/</span>usr<span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>releaseVol1<span class="token operator">/</span>static<span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">## 媒体文件，用户上传的文件</span>
        <span class="token comment">##location /media/ {</span>
        <span class="token comment">##        alias /var/www/childrenshop/media/;</span>
        <span class="token comment">##}</span>

        <span class="token comment">##error_page  404              /404.html;</span>

        <span class="token comment">## 将服务器的错误页面重定向到静态页面 /50x.html</span>
        <span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
            <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>2、访问</p> <p>在防火墙中开放对应的端口，譬如：8996</p> <p>在浏览器中访问即可</p> <p>注意：别忘记将 uwsgi.ini 的配置中端口配置的 http = 修改为 socket =</p> <p>3、实现负载均衡</p> <p>在本文档中演示第二个uwsgi，复制一份新的配置文件，修改后，启动：</p> <p>uwsgi1.ini</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[uwsgi]</span>
<span class="token comment">## 虚拟主机模式</span>
<span class="token constant">vhost</span> <span class="token attr-value"><span class="token punctuation">=</span> false</span>
<span class="token comment">## ip端口</span>
<span class="token constant">socket</span> <span class="token attr-value"><span class="token punctuation">=</span> 0.0.0.0:8998</span>
<span class="token comment">## 是否主服务器</span>
<span class="token constant">master</span> <span class="token attr-value"><span class="token punctuation">=</span> true</span>
<span class="token comment">## 是否多线程</span>
<span class="token constant">enable-threads</span> <span class="token attr-value"><span class="token punctuation">=</span> true</span>
<span class="token comment">## 工作进程数</span>
<span class="token constant">workers</span> <span class="token attr-value"><span class="token punctuation">=</span> 5</span>
<span class="token comment">## wsgi文件的位置</span>
<span class="token constant">wsgi-file</span> <span class="token attr-value"><span class="token punctuation">=</span> /var/www/childrenshop/middleware_study/wsgi.py</span>
<span class="token comment">## 项目的根目录</span>
<span class="token constant">chdir</span> <span class="token attr-value"><span class="token punctuation">=</span> /var/www/childrenshop/</span>
<span class="token comment">##limit-as = 256</span>
<span class="token constant">pidfile</span> <span class="token attr-value"><span class="token punctuation">=</span> /var/run/uwsgi1.pid</span>
<span class="token constant">daemonize</span> <span class="token attr-value"><span class="token punctuation">=</span> /var/www/childrenshop/logs/uwsgi1.log</span>

</code></pre></div><p>启动 uwsgi1</p> <div class="language- extra-class"><pre class="language-text"><code>/usr/local/python36/bin/uwsgi --ini /var/www/childrenshop/uwsgi1.ini
</code></pre></div><p>nginx.conf：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment">## 和 server 平级配置，写在server上面</span>
<span class="token keyword">upstream</span> mycom <span class="token punctuation">{</span> 
    <span class="token comment">## 采用默认轮询</span>
    <span class="token comment">## ip_hash;</span>
    <span class="token keyword">server</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8997</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8998</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 

<span class="token comment">## server下的 location 配置中，修改：</span>
uwsgi_pass mycom<span class="token punctuation">;</span>

</code></pre></div><p>4、测试访问，同时监听2个uwsgi服务器日志输出，可以看到负载均衡的效果</p> <p>5.子路径</p> <div class="language- extra-class"><pre class="language-text"><code> server {
                listen 80;
                server_name  testapp.com;
                location / {
                        root /usr/share/nginx/html/official_web/; 
                        index  index.html index.htm;
                        ## try_files $uri $uri/ /index.html;
                }
                ###### oms ######
                location  /oms {
                     alias /usr/share/nginx/html/oms;   ##注意就是这一行，根路径除了首个root其余都应该为alias
                     index index.html index.htm;
                     ## try_files $uri $uri/ /oms/index.html;
                }
                ## ......  ##
        }
</code></pre></div><h6 id="_4-外网访问虚拟机"><a href="#_4-外网访问虚拟机" class="header-anchor">#</a> 4.外网访问虚拟机</h6> <p>需要修改nginx.conf</p> <p>将server_name  修改为域名;</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">http</span><span class="token punctuation">{</span>
  <span class="token keyword">server</span><span class="token punctuation">{</span>
  	<span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> www<span class="token punctuation">.</span>inotes<span class="token punctuation">.</span>top <span class="token comment">##如果主机的ip地址更改如重连了无线，则需要将去对应网站修改域名解析</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
	
</code></pre></div><p>在vm（虚拟机）中配置NAT网络设置，Mac通过command+','调出偏好设置</p> <div class="language-text extra-class"><pre class="language-text"><code>  &lt;img src=&quot;/Users/qyp/Desktop/屏幕快照 2021-01-05 23.38.15.png&quot; alt=&quot;屏幕快照 2021-01-05 23.38.15&quot; style=&quot;zoom:50%;&quot; /&gt;

</code></pre></div><p>重启network</p> <div class="language- extra-class"><pre class="language-text"><code>service network restart
</code></pre></div><p>这样就把虚拟机的ip:post和主机的端口映射，这里的虚拟机端口应与nignx对应，相当于将主机当做一个路由而虚拟机为一个分机</p> <p>最后需要在路由器页面设置DMZ主机</p> <p>![屏幕快照 2021-01-05 23.43.56](/Users/qyp/Desktop/屏幕快照 2021-01-05 23.43.56.png)</p> <p>如果连接有线，可以固定本机ip</p> <p>在路由设置 &gt;&gt; 网络参数中设置</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/django-content/20-REST framework.html" class="prev">
        REST framework
      </a></span> <span class="next"><a href="/notes/django-content/22-文件云存储.html">
        文件云存储
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.693f674f.js" defer></script><script src="/notes/assets/js/2.ee803d5e.js" defer></script><script src="/notes/assets/js/41.cb3f7d02.js" defer></script>
  </body>
</html>
