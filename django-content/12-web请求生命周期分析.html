<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>web请求生命周期分析 | 还隔这查文档，我上来就是一拳</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/notes/assets/css/0.styles.046e0507.css" as="style"><link rel="preload" href="/notes/assets/js/app.693f674f.js" as="script"><link rel="preload" href="/notes/assets/js/2.ee803d5e.js" as="script"><link rel="preload" href="/notes/assets/js/32.f91948f2.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.8df4875c.js"><link rel="prefetch" href="/notes/assets/js/100.8bdd21e6.js"><link rel="prefetch" href="/notes/assets/js/101.6e8be7dd.js"><link rel="prefetch" href="/notes/assets/js/102.53ab07dc.js"><link rel="prefetch" href="/notes/assets/js/103.9a825864.js"><link rel="prefetch" href="/notes/assets/js/104.aa5af432.js"><link rel="prefetch" href="/notes/assets/js/105.ea9a56c7.js"><link rel="prefetch" href="/notes/assets/js/106.ec33f3ad.js"><link rel="prefetch" href="/notes/assets/js/107.e7009964.js"><link rel="prefetch" href="/notes/assets/js/108.52c1f920.js"><link rel="prefetch" href="/notes/assets/js/109.65d686e4.js"><link rel="prefetch" href="/notes/assets/js/11.1496d8e0.js"><link rel="prefetch" href="/notes/assets/js/110.dd503851.js"><link rel="prefetch" href="/notes/assets/js/111.713cd005.js"><link rel="prefetch" href="/notes/assets/js/112.b008e42d.js"><link rel="prefetch" href="/notes/assets/js/113.8765549b.js"><link rel="prefetch" href="/notes/assets/js/114.c1ab5490.js"><link rel="prefetch" href="/notes/assets/js/115.3d9d10df.js"><link rel="prefetch" href="/notes/assets/js/116.21bac402.js"><link rel="prefetch" href="/notes/assets/js/117.80ca349e.js"><link rel="prefetch" href="/notes/assets/js/118.264dfbfd.js"><link rel="prefetch" href="/notes/assets/js/119.94abe060.js"><link rel="prefetch" href="/notes/assets/js/12.48b964d8.js"><link rel="prefetch" href="/notes/assets/js/120.a1e95cca.js"><link rel="prefetch" href="/notes/assets/js/121.920f0871.js"><link rel="prefetch" href="/notes/assets/js/122.fa2c1331.js"><link rel="prefetch" href="/notes/assets/js/123.ae900d0b.js"><link rel="prefetch" href="/notes/assets/js/124.a681e4ad.js"><link rel="prefetch" href="/notes/assets/js/125.9dc36731.js"><link rel="prefetch" href="/notes/assets/js/126.19b0b6f6.js"><link rel="prefetch" href="/notes/assets/js/127.753e1762.js"><link rel="prefetch" href="/notes/assets/js/128.04d224d3.js"><link rel="prefetch" href="/notes/assets/js/129.96ed219e.js"><link rel="prefetch" href="/notes/assets/js/13.7a358a5b.js"><link rel="prefetch" href="/notes/assets/js/130.31efda50.js"><link rel="prefetch" href="/notes/assets/js/131.1fbd9731.js"><link rel="prefetch" href="/notes/assets/js/132.24cbfa83.js"><link rel="prefetch" href="/notes/assets/js/133.3d541007.js"><link rel="prefetch" href="/notes/assets/js/134.87101ac5.js"><link rel="prefetch" href="/notes/assets/js/135.25562a0d.js"><link rel="prefetch" href="/notes/assets/js/136.55d387c0.js"><link rel="prefetch" href="/notes/assets/js/137.b70e6a0a.js"><link rel="prefetch" href="/notes/assets/js/138.b4a0d289.js"><link rel="prefetch" href="/notes/assets/js/139.eb1b9d08.js"><link rel="prefetch" href="/notes/assets/js/14.fb3a52e3.js"><link rel="prefetch" href="/notes/assets/js/140.906e8f92.js"><link rel="prefetch" href="/notes/assets/js/141.a9c1d0ff.js"><link rel="prefetch" href="/notes/assets/js/142.10d4f3f3.js"><link rel="prefetch" href="/notes/assets/js/143.70d396fb.js"><link rel="prefetch" href="/notes/assets/js/144.cf7ba1e8.js"><link rel="prefetch" href="/notes/assets/js/145.3056455a.js"><link rel="prefetch" href="/notes/assets/js/146.97300387.js"><link rel="prefetch" href="/notes/assets/js/147.c552d920.js"><link rel="prefetch" href="/notes/assets/js/148.24cd5671.js"><link rel="prefetch" href="/notes/assets/js/149.39dd402e.js"><link rel="prefetch" href="/notes/assets/js/15.c8adf5ed.js"><link rel="prefetch" href="/notes/assets/js/150.1e0e74cc.js"><link rel="prefetch" href="/notes/assets/js/151.7a5ef1a1.js"><link rel="prefetch" href="/notes/assets/js/152.82103aef.js"><link rel="prefetch" href="/notes/assets/js/153.64f23cb0.js"><link rel="prefetch" href="/notes/assets/js/154.e10ca008.js"><link rel="prefetch" href="/notes/assets/js/155.26add57a.js"><link rel="prefetch" href="/notes/assets/js/156.baba0d11.js"><link rel="prefetch" href="/notes/assets/js/157.9ed8cc70.js"><link rel="prefetch" href="/notes/assets/js/158.a8f99100.js"><link rel="prefetch" href="/notes/assets/js/159.7a274487.js"><link rel="prefetch" href="/notes/assets/js/16.06250b71.js"><link rel="prefetch" href="/notes/assets/js/160.bf19e881.js"><link rel="prefetch" href="/notes/assets/js/161.ca8ce943.js"><link rel="prefetch" href="/notes/assets/js/162.ca4bba30.js"><link rel="prefetch" href="/notes/assets/js/163.3a76e583.js"><link rel="prefetch" href="/notes/assets/js/164.6ab4321a.js"><link rel="prefetch" href="/notes/assets/js/165.cdb63940.js"><link rel="prefetch" href="/notes/assets/js/166.5a97199c.js"><link rel="prefetch" href="/notes/assets/js/167.7e3ec094.js"><link rel="prefetch" href="/notes/assets/js/168.035592fa.js"><link rel="prefetch" href="/notes/assets/js/169.366a4304.js"><link rel="prefetch" href="/notes/assets/js/17.a6f856ad.js"><link rel="prefetch" href="/notes/assets/js/170.7c9cc147.js"><link rel="prefetch" href="/notes/assets/js/171.cf5a48d8.js"><link rel="prefetch" href="/notes/assets/js/172.19e2f582.js"><link rel="prefetch" href="/notes/assets/js/173.9a12226f.js"><link rel="prefetch" href="/notes/assets/js/174.f083b849.js"><link rel="prefetch" href="/notes/assets/js/18.9be01929.js"><link rel="prefetch" href="/notes/assets/js/19.0bff607d.js"><link rel="prefetch" href="/notes/assets/js/20.cceec89f.js"><link rel="prefetch" href="/notes/assets/js/21.876e28fc.js"><link rel="prefetch" href="/notes/assets/js/22.89577694.js"><link rel="prefetch" href="/notes/assets/js/23.fc1bb7ef.js"><link rel="prefetch" href="/notes/assets/js/24.e7122983.js"><link rel="prefetch" href="/notes/assets/js/25.02c1de2c.js"><link rel="prefetch" href="/notes/assets/js/26.16d528fe.js"><link rel="prefetch" href="/notes/assets/js/27.efc0eba1.js"><link rel="prefetch" href="/notes/assets/js/28.d688a8e3.js"><link rel="prefetch" href="/notes/assets/js/29.2584d6d0.js"><link rel="prefetch" href="/notes/assets/js/3.c81b0709.js"><link rel="prefetch" href="/notes/assets/js/30.5bef4ddc.js"><link rel="prefetch" href="/notes/assets/js/31.0b0aa28e.js"><link rel="prefetch" href="/notes/assets/js/33.65519de3.js"><link rel="prefetch" href="/notes/assets/js/34.6a59642b.js"><link rel="prefetch" href="/notes/assets/js/35.0b951c50.js"><link rel="prefetch" href="/notes/assets/js/36.c1229a87.js"><link rel="prefetch" href="/notes/assets/js/37.f45f88c7.js"><link rel="prefetch" href="/notes/assets/js/38.a292be28.js"><link rel="prefetch" href="/notes/assets/js/39.ac7b814f.js"><link rel="prefetch" href="/notes/assets/js/4.acc16a77.js"><link rel="prefetch" href="/notes/assets/js/40.6d1a2236.js"><link rel="prefetch" href="/notes/assets/js/41.cb3f7d02.js"><link rel="prefetch" href="/notes/assets/js/42.57119e51.js"><link rel="prefetch" href="/notes/assets/js/43.04d6c2fc.js"><link rel="prefetch" href="/notes/assets/js/44.3e7a3100.js"><link rel="prefetch" href="/notes/assets/js/45.f9bed2f1.js"><link rel="prefetch" href="/notes/assets/js/46.408d5e96.js"><link rel="prefetch" href="/notes/assets/js/47.42049855.js"><link rel="prefetch" href="/notes/assets/js/48.c07f0eb0.js"><link rel="prefetch" href="/notes/assets/js/49.763dad5f.js"><link rel="prefetch" href="/notes/assets/js/5.19114815.js"><link rel="prefetch" href="/notes/assets/js/50.16466921.js"><link rel="prefetch" href="/notes/assets/js/51.77613262.js"><link rel="prefetch" href="/notes/assets/js/52.371b49d2.js"><link rel="prefetch" href="/notes/assets/js/53.afdfb70b.js"><link rel="prefetch" href="/notes/assets/js/54.0700a309.js"><link rel="prefetch" href="/notes/assets/js/55.f17aa88f.js"><link rel="prefetch" href="/notes/assets/js/56.7ba59c60.js"><link rel="prefetch" href="/notes/assets/js/57.6ab33601.js"><link rel="prefetch" href="/notes/assets/js/58.3df2ea7e.js"><link rel="prefetch" href="/notes/assets/js/59.f05a40b5.js"><link rel="prefetch" href="/notes/assets/js/6.fbd39b4b.js"><link rel="prefetch" href="/notes/assets/js/60.e243c11f.js"><link rel="prefetch" href="/notes/assets/js/61.e56bf6b9.js"><link rel="prefetch" href="/notes/assets/js/62.aade55a7.js"><link rel="prefetch" href="/notes/assets/js/63.14962c3b.js"><link rel="prefetch" href="/notes/assets/js/64.a1883e51.js"><link rel="prefetch" href="/notes/assets/js/65.6c099679.js"><link rel="prefetch" href="/notes/assets/js/66.3e2bb8f1.js"><link rel="prefetch" href="/notes/assets/js/67.0fa3630d.js"><link rel="prefetch" href="/notes/assets/js/68.ed132600.js"><link rel="prefetch" href="/notes/assets/js/69.c7d0f351.js"><link rel="prefetch" href="/notes/assets/js/7.157e2031.js"><link rel="prefetch" href="/notes/assets/js/70.b6f8bbee.js"><link rel="prefetch" href="/notes/assets/js/71.a1072810.js"><link rel="prefetch" href="/notes/assets/js/72.b75efabd.js"><link rel="prefetch" href="/notes/assets/js/73.a670a6c0.js"><link rel="prefetch" href="/notes/assets/js/74.75ac7a5d.js"><link rel="prefetch" href="/notes/assets/js/75.d5442c48.js"><link rel="prefetch" href="/notes/assets/js/76.6ad52012.js"><link rel="prefetch" href="/notes/assets/js/77.ec21c444.js"><link rel="prefetch" href="/notes/assets/js/78.d2379aab.js"><link rel="prefetch" href="/notes/assets/js/79.ac499ef3.js"><link rel="prefetch" href="/notes/assets/js/8.c2e802f8.js"><link rel="prefetch" href="/notes/assets/js/80.deb3a426.js"><link rel="prefetch" href="/notes/assets/js/81.ea9cbddc.js"><link rel="prefetch" href="/notes/assets/js/82.b8544b95.js"><link rel="prefetch" href="/notes/assets/js/83.8c22bdcf.js"><link rel="prefetch" href="/notes/assets/js/84.4895fe5c.js"><link rel="prefetch" href="/notes/assets/js/85.93ab470a.js"><link rel="prefetch" href="/notes/assets/js/86.fd086a14.js"><link rel="prefetch" href="/notes/assets/js/87.7d842136.js"><link rel="prefetch" href="/notes/assets/js/88.d3ad256a.js"><link rel="prefetch" href="/notes/assets/js/89.0fdbabf5.js"><link rel="prefetch" href="/notes/assets/js/9.1e8ef9c9.js"><link rel="prefetch" href="/notes/assets/js/90.c979d5eb.js"><link rel="prefetch" href="/notes/assets/js/91.fffbe9ac.js"><link rel="prefetch" href="/notes/assets/js/92.f46c7ae3.js"><link rel="prefetch" href="/notes/assets/js/93.50976afb.js"><link rel="prefetch" href="/notes/assets/js/94.e9bd725d.js"><link rel="prefetch" href="/notes/assets/js/95.0cf70666.js"><link rel="prefetch" href="/notes/assets/js/96.d5f09b5d.js"><link rel="prefetch" href="/notes/assets/js/97.c2c13071.js"><link rel="prefetch" href="/notes/assets/js/98.b83d8452.js"><link rel="prefetch" href="/notes/assets/js/99.382efddd.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.046e0507.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">还隔这查文档，我上来就是一拳</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/notes/django-content/01-django介绍和相关术语.html" class="nav-link">
  Django
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/vue-content/基础内容/vue初体验.html" class="nav-link">
  基础内容
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/组件化/组件化.html" class="nav-link">
  组件化
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/webpack/安装与基本设置.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/CLI脚手架/CLI安装与项目创建.html" class="nav-link">
  CLI
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Vue-router/前端路由.html" class="nav-link">
  vue-router
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Vuex/介绍.html" class="nav-link">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/axios网络模块/基本使用.html" class="nav-link">
  axios网络模块
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Uni-app/图片choose_preview_uploadFile.html" class="nav-link">
  uni-app
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/常用代码和json文件/头像图片裁剪与上传.html" class="nav-link">
  常用代码和json文件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="css" class="dropdown-title"><span class="title">css</span> <span class="arrow down"></span></button> <button type="button" aria-label="css" class="mobile-dropdown-title"><span class="title">css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/css-content/css基础.html" class="nav-link">
  css基础
</a></li><li class="dropdown-item"><!----> <a href="/notes/css-content/常用网站.html" class="nav-link">
  常用网站
</a></li></ul></div></div><div class="nav-item"><a href="/notes/pieceknowledge/文档碎片操作dom.html" class="nav-link">
  小知识点
</a></div><div class="nav-item"><a href="/notes/diary/20210602.html" class="nav-link">
  日记
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/notes/django-content/01-django介绍和相关术语.html" class="nav-link">
  Django
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/vue-content/基础内容/vue初体验.html" class="nav-link">
  基础内容
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/组件化/组件化.html" class="nav-link">
  组件化
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/webpack/安装与基本设置.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/CLI脚手架/CLI安装与项目创建.html" class="nav-link">
  CLI
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Vue-router/前端路由.html" class="nav-link">
  vue-router
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Vuex/介绍.html" class="nav-link">
  vuex
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/axios网络模块/基本使用.html" class="nav-link">
  axios网络模块
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/Uni-app/图片choose_preview_uploadFile.html" class="nav-link">
  uni-app
</a></li><li class="dropdown-item"><!----> <a href="/notes/vue-content/常用代码和json文件/头像图片裁剪与上传.html" class="nav-link">
  常用代码和json文件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="css" class="dropdown-title"><span class="title">css</span> <span class="arrow down"></span></button> <button type="button" aria-label="css" class="mobile-dropdown-title"><span class="title">css</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/css-content/css基础.html" class="nav-link">
  css基础
</a></li><li class="dropdown-item"><!----> <a href="/notes/css-content/常用网站.html" class="nav-link">
  常用网站
</a></li></ul></div></div><div class="nav-item"><a href="/notes/pieceknowledge/文档碎片操作dom.html" class="nav-link">
  小知识点
</a></div><div class="nav-item"><a href="/notes/diary/20210602.html" class="nav-link">
  日记
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/notes/vue-content/基础内容/vue初体验/" class="sidebar-heading clickable"><span>Vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/django-content/01-django介绍和相关术语" class="sidebar-heading clickable open"><span>Django</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/django-content/01-django介绍和相关术语.html" class="sidebar-link">django介绍和相关术语</a></li><li><a href="/notes/django-content/02-python虚拟环境.html" class="sidebar-link">python虚拟环境</a></li><li><a href="/notes/django-content/03-项目搭建.html" class="sidebar-link">项目搭建</a></li><li><a href="/notes/django-content/04-django配置.html" class="sidebar-link">django配置</a></li><li><a href="/notes/django-content/05-URLConf调度器.html" class="sidebar-link">URLConf调度器</a></li><li><a href="/notes/django-content/06-模型.html" class="sidebar-link">模型</a></li><li><a href="/notes/django-content/07-视图.html" class="sidebar-link">视图</a></li><li><a href="/notes/django-content/09-admin后台管理.html" class="sidebar-link">admin后台管理</a></li><li><a href="/notes/django-content/10-会话技术.html" class="sidebar-link">会话技术</a></li><li><a href="/notes/django-content/11-分页器.html" class="sidebar-link">分页器</a></li><li><a href="/notes/django-content/12-web请求生命周期分析.html" class="active sidebar-link">web请求生命周期分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/django-content/12-web请求生命周期分析.html#一、web请求生命周期分析" class="sidebar-link">一、web请求生命周期分析</a></li></ul></li><li><a href="/notes/django-content/13-验证码.html" class="sidebar-link">验证码</a></li><li><a href="/notes/django-content/14-中间件.html" class="sidebar-link">中间件</a></li><li><a href="/notes/django-content/15-日志.html" class="sidebar-link">信号signals</a></li><li><a href="/notes/django-content/16-信号signals.html" class="sidebar-link">django的信号signals</a></li><li><a href="/notes/django-content/17-缓存redis.html" class="sidebar-link">缓存redis</a></li><li><a href="/notes/django-content/18-Celery.html" class="sidebar-link">Celery</a></li><li><a href="/notes/django-content/19-DebugToolBar.html" class="sidebar-link">DebugToolBar</a></li><li><a href="/notes/django-content/20-REST framework.html" class="sidebar-link">REST framework</a></li><li><a href="/notes/django-content/21-项目部署.html" class="sidebar-link">项目部署</a></li><li><a href="/notes/django-content/22-文件云存储.html" class="sidebar-link">文件云存储</a></li><li><a href="/notes/django-content/23-富文本DjangoUeditor.html" class="sidebar-link">富文本DjangoUeditor</a></li><li><a href="/notes/django-content/24-文件上传和下载.html" class="sidebar-link">文件上传和下载</a></li><li><a href="/notes/django-content/25-项目开发流程.html" class="sidebar-link">项目开发流程</a></li><li><a href="/notes/django-content/26-邮箱验证和短信验证.html" class="sidebar-link">邮箱验证和短信验证</a></li><li><a href="/notes/django-content/27-模板jinja2引擎.html" class="sidebar-link">模板jinja2引擎</a></li><li><a href="/notes/django-content/28-JWT.html" class="sidebar-link">JWT</a></li><li><a href="/notes/django-content/29-微信小程序登录.html" class="sidebar-link">微信小程序登录</a></li><li><a href="/notes/django-content/30-爬虫.html" class="sidebar-link">爬虫</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/css-content/css基础" class="sidebar-heading clickable"><span>Css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/pieceknowledge/文档碎片操作dom" class="sidebar-heading clickable"><span>小知识点</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/diary/20210602" class="sidebar-heading clickable"><span>diary</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="web请求生命周期分析"><a href="#web请求生命周期分析" class="header-anchor">#</a> web请求生命周期分析</h1> <h2 id="一、web请求生命周期分析"><a href="#一、web请求生命周期分析" class="header-anchor">#</a> 一、web请求生命周期分析</h2> <h4 id="_1、概述"><a href="#_1、概述" class="header-anchor">#</a> 1、概述</h4> <p>​	web请求是基于http协议的，而http协议是基于请求/响应的模式，即一个请求对应一个响应，那么一个web请求（或者说http请求）的生命周期就是指从发起一个web请求到得到web响应的过程</p> <ul><li>web请求的发起：一般是指在浏览器中输入一个url地址，但是并不仅限于此，譬如我们在网页中点击一个url链接或者javascript脚本中执行一个url跳转（包括普通的和ajax方式的）等</li> <li>web响应的获取：一般是显示在浏览器中的一个页面，但是也并不仅限于此，有些是后台数据的获取，譬如javascript访问的json数据、图片、文件等</li></ul> <h4 id="_2、相关知识点"><a href="#_2、相关知识点" class="header-anchor">#</a> 2、相关知识点</h4> <h6 id="_1、网络核心结构"><a href="#_1、网络核心结构" class="header-anchor">#</a> 1、网络核心结构</h6> <p>​	计算机的网络核心结构，就是TCP/IP五层网络模型（OSI七层网络模型将应用层拆分为三层了），如下图：</p> <ul><li><p>发送请求的过程是从最顶层（应用层）出发，每一层负责封装属于自己的信息到请求中，最后将一整个请求发送给对方。</p></li> <li><p>接收请求的过程是从最底层（网络接口层）开始，每一层的协议负责解析属于自己的东西，比如网络层(IP)处理ip信息，传输层(TCP)处理点对点的端口，应用层(HTTP)处理Request或Response的Line\Header\Body。</p></li></ul> <h6 id="_2、tcp协议"><a href="#_2、tcp协议" class="header-anchor">#</a> 2、TCP协议</h6> <p>​	TCP(Transmission Control Protocol，传输控制协议)是一种面向连接(连接导向)的、可靠的基于字节流的传输层通信协议。TCP将用户数据打包成报文段，它发送后启动一个定时器，另一端收到的数据进行确认、对失序的数据重新排序、丢弃重复数据。</p> <p>​	头格式如下(单位 bit)：</p> <ol><li>Source Port(源端口号）：数据发起者的端口号，16bit。</li> <li>Destination Port(目的端口号）：数据接收者的端口号，16bit。</li> <li>Sequence Number(顺序号码，Seq）：用于在数据通信中解决网络包乱序(reordering)问题，以保证应用层接收到的数据不会因为网络上的传输问题而乱序(TCP会用这个顺序号码来拼接数据），32bit。</li> <li>Acknowledgment Number(确认号码，ack）：是数据接收方期望收到发送方在下一个报文段的顺序号码（Seq），因此确认号码应当是上次已成功收到顺序号码(Seq)加1，32bit。</li> <li>Offset(TCP报文头长度)：用于存储报文头中有多少个32bit(上图的一行)，存储长度为4bit，最大可表示（2^3+2^2+2^1+1）<em>32bit=60bytes的报文头。最小取值5，5</em>32bit=20bytes。</li> <li>Reserved(保留)：6bit, 均为0</li> <li>TCP Flags(TCP标识位)每个长度均为1bit</li></ol> <p>​       CWR：压缩，TCP Flags值0x80。</p> <p>​       ECE：拥塞，0x40。</p> <p>​       URG：紧急，0x20。当URG=1时，表示报文段中有紧急数据，应尽快传送。</p> <p>​       ACK：确认，0x10。当ACK = 1时，代表这是一个确认的TCP包，取值0则不是确认包。</p> <p>​       PSH：推送，0x08。当发送端PSH=1时，接收端尽快的交付给应用进程。</p> <p>​       RST：复位，0x04。当RST=1时，表明TCP连接中出现严重差错，必须释放连接，再重新建立连接。</p> <p>​       SYN：同步，0x02。在建立连接时用来同步序号。SYN=1， ACK=0表示一个连接请求报文段。SYN=1，ACK=1表示同意建立连接。</p> <p>​       FIN：终止，0x01。当FIN=1时，表明此报文段的发送端的数据已经发送完毕，并要求释放传输连接。</p> <ol start="8"><li>窗口：用来控制对方发送的数据量，通知发放已确定的发送窗口上限。</li> <li>检验和：该字段检验的范围包括头部和数据这两部分。由发端计算和存储，并由收端进行验证</li> <li>紧急指针：紧急指针在URG=1时才有效，它指出本报文段中的紧急数据的字节数。</li> <li>TCP选项：长度可变，最长可达40字节</li></ol> <p>​	三次握手（建立连接的过程，只能客户端发起）：</p> <ol><li>客户端主动发送SYN包到服务器，并进入SYN_SEND状态，等待服务器确认</li> <li>服务器收到SYN包并确认，发送SYN+ACK到客户端，服务器进入SYN_RECV状态</li> <li>客户端收到SYN+ACK包，发送ACK确认连接，发送完毕后客户端和服务端进入ESTABLISHED状态，完成三次握手</li></ol> <p>​	完成三次握手之后，TCP才可以开始进行真正的数据传输</p> <p>​	四次挥手（断开连接的过程，可以是客户端发起，也可以是服务器端发起，下面以客户端演示）：</p> <ol><li>主机A主动发送FIN包，等待主机B确认</li> <li>主机B收到FIN包并确认，发送ACK包到主机A</li> <li>主机B发送FIN包到主机A，并等待主机A确认</li> <li>主机A收到FIN包并确认，发送ACK包到主机B，并且丢弃连接，主机B收到ACK包后，丢弃连接</li></ol> <h6 id="_3、http协议"><a href="#_3、http协议" class="header-anchor">#</a> 3、http协议</h6> <p>​	超文本传输协议(HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议，所有的WWW文件都必须遵守这个标准，属于TCP/IP协议的应用层协议。</p> <p>​	HTTP是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。它于1990年提出，经过几年的使用与发展，得到不断地完善和扩展。</p> <ul><li><p>1991年推出HTTP/0.9</p></li> <li><p>1996年推出HTTP/1.0</p></li> <li><p>1999年推出HTTP/1.1</p></li> <li><p>2015年推出HTTP/2</p> <p>目前使用最广泛的还是HTTP/1.1版本</p></li></ul> <p>​	URL（统一资源定位符）：是一种特殊的URI（统一资源标识符），包含了用于查找某个资源的足够的信息，格式如下：</p> <p>​	http://host[:port][abs_path]?arg1=value1&amp;arg2=value2</p> <p>​	https://host[:port][abs_path]?arg1=value1&amp;arg2=value2</p> <p>​	说明如下：</p> <ul><li>http或https表示要通过哪个协议来定位网络资源；</li> <li>host表示合法的Internet主机域名或者IP地址；</li> <li>port指定一个端口号，为空则使用缺省端口（http是80，https是443）；</li> <li>abs_path指定请求资源的路径</li> <li>? 之后的内容是请求参数，用于传递数据给服务器</li></ul> <p>​	http请求：由三部分组成，分别是：请求行、请求头、请求体</p> <p>​	示例（百度登录请求）：</p> <div class="language- extra-class"><pre class="language-text"><code>POST /v2/api/?login HTTP/1.1
Host: passport.baidu.com
Connection: keep-alive
Content-Length: 2952
Cache-Control: max-age=0
Origin: https://www.baidu.com
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Referer: https://www.baidu.com/?tn=93882546_hao_pg
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: BAIDUID=311E2F4D0EBD022DEF679D1669ABDA5E:FG=1; BIDUPSID=311E2F4D0EBD022DEF679D1669ABDA5E; PSTM=1518263013; BDRCVFR[MR02hGxyoCt]=n4QtfkUpMj3XZN4pgPWQhPEUf; H_PS_PSSID=; HOSUPPORT=1; FP_UID=46c02caec5901194ab8efae92be3a433; UBI=fi_PncwhpxZ%7ETaKAT9p784t3RaHLuAic2iv9oBYbhONamuLF2uMuBXPcd5myIbqV4zYbuJyfGkNp-qoLA3f

staticpage=https%3A%2F%2Fwww.baidu.com%2Fcache%2Fuser%2Fhtml%2Fv3Jump.html&amp;charset=UTF-8&amp;token=dae86b918bb5266fd7d94132271a6b68&amp;tpl=mn&amp;subpro=&amp;apiver=v3&amp;tt=1518266296874&amp;codestring=jxG4807c1f71181c16d025115c14301247f884a430735047e38&amp;safeflg=0&amp;u=https%3A%2F%2Fwww.baidu.com%2F%3Ftn%3D93882546_hao_pg&amp;isPhone=&amp;detect=1&amp;gid=52342BA-C1AC-4062-BBD0-8C67681E0D24&amp;quick_user=0&amp;logintype=dialogLogin&amp;logLoginType=pc_loginDialog&amp;idc=&amp;loginmerge=true&amp;splogin=rate&amp;username=mumuloveshine&amp;password=KQueIucNzF0fy78bKHTPQxYb0yrvcQ341y3zq0I86foUW9e%2BjGaTwwlgd2MSmMlWCPqJwZbXoim7wqbFuySCjDtz2gFWdrcDiL9I1b2rUWLN5b7vUHBItKXDGcS7g%2FUKzrm%2FaJcQn13f8eRJfUVw4RjczfLnnegXb0ZpdSmcnkE%3D&amp;verifycode=%E5%A5%B3%E5%AD%A9&amp;mem_pass=on&amp;rsakey=zYBPxF7R8Ucf8O5JkF3HPVBCnaY0hRMD&amp;crypttype=12&amp;ppui_logintime=20572&amp;countrycode=&amp;fp_uid=46c02caec5901194ab8efae92be3a433&amp;fp_info=46c02caec5901194ab8efae92be3a433002%7E%7E%7E-r--5LhFGVwgn%7E5_u--4vhxn7nVCBTkCeT_hhxn7nVCBTkneT_V-kTsP-kTsH--sz-k-sQh0I-LXKSCbjKAe6Kn%7EcKCeLjA7YxLX8%7EAOn%7EA7qkC%7Eqjn7ojUOI%7EC74zA7q%7EnmOjUwLaCe6kC7okA7wxLVKSHl2DLVc_%7Eu-qMu-qOu-qtu-ssh0VkcX1aFX2tpXGopVChpJGgFoHWLlhyFZ82pl2tpXG%7EGVwOHEH9plGDMJCwpBCwLVHWLBsD4Ewt4JCPpVH5Gohn4EGOMJfWFlwOHJ1epVjzHJjz3tyVHEr%7EMJ1gAeogCZIj3eoKC%7Eq9Dh0lwHXGl4EGDFbjepVhiFJj94V2zMJ1gLkI%7ECmreCmYOA7q%7E4%7EczA7nIC7nV4%7E6InlHtnlGtHJHlC7FwHmywn%7ECtnmsyneFenJrl4ewy4lClHl2yAXnInXoVUlrt4eHy4e4Kn%7Eye4ecVH72l4JHwCV2wHmCOnlnVHmYln%7E2l4l5hAJcanV4%7En%7ECOn%7EFlHmohn76InXHeHecaAX2xAJ2tCmOkHJ2wCmHyHe5aHmGenXYyH7Cw4%7ET84J5zCmyeC7wOn7TaCerlH7yy47chHX4V4%7E68CVnan7L8CeyeCkjeCeLzn%7E4jH7CwCecjCloKCXre4estn%7EHOnmOhH7COAXCeHX4hnVoaAJYlCJYl4%7EOKnm5KHmTk47TjC7CtA74VUlYwHl2hpbYx4V1ipEGgMJCyFXwWpBCxCXCe4V2w4%7EYlAm5jC%7ECeCl48AXo%7ECmst4lchHJnICeweH72O4%7EYt4Vnhn%7E6KC%7Enanl68nmqhHenanmyOAJojCkjw4eFeCeTaCXo8nX6zCVreAmL%7EnV4knJnVHJYl476hHXnkC%7EOj47COAJGOC7oaA7oz4lchCVClH7TanXGyHm5zAu-sTu-syu-sxu-sW--5KhFRlTi6zI_FhxFJjPpl1kpT__-u-sG--qIu-qYu-qiu-qcu-qau-qNhV37ogCm58Cm6IAm5%7EAmLzC%7E5zC6__&amp;loginversion=v4&amp;dv=tk0.57134848608022451518266276367%40vAt0nmsmad9kr%7E9koc9koy9krcsmacs4ogs4rd9krjsmac24Sgs4Hz9krzs1ac2%7Eogs4Sa9krds1ayskHgsF6%7E9k0j21ay2%7ESgsF5d9ksasS__vt0lBsF0d9kqgJrtBGjuh4JeT6t2oE%7EraEjej5-Jy4WtVCAa-24rj9ksasMaysF3gsmc6o6dp63t2Ejeo6jhTs4hTEzJ%7ECEuBHKjL9kHlsFqgs%7EqyTk0yBAac9tGh43QAo6jTEjh46tvcsteTQE2L53dIOK6g2%7E0zsAa%7Eskuv9kqgJrtBGjuh4JeT6t2oE%7EraEjej5-Jy4WtVCAalB43%7E9ksasMad9kqgJrtBGjuh4JeT6t2oE%7EraEjej5-Jy4WtVCAadB4s-9ksasMa_ut0yB2F6z9kocsAay24o%7E9ma%7Eskuv2%7Eqd9kSg2kq%7EsAags%7EqyTk6-Bmay24Sgs40z2kHgJrtBGjuh4JeT6t2oE%7EraEje-CEuXCMLkO-GL9ksasMaz24rgsFSd9krjBksl9tGh43QAo6jTEjh46tvcsteTQWJyPKCdo-e3C6LVCya%7Eskuv245c9k0%7EsmacB43a2mc6o6dp63t2Ejeo6jhTs4hTEzhI5z2zOzu39ksasMa_BmmC%7Emx37ZTPhxthsAay9kHbztqQnga9F6zs4sbBkol2Fqlsk0y2k6c24rlsFH-sF5-s%7EHzht0LmPpGb5psR9yezQz5ZHWtXCp6ZH-eV9%7EebOFbds%7ESlsF6b2LeUHKeT5n5gQKd3CKCXOWJ3wtlB4og94olsmacs%7Esl9k6c2yacs%7EH-9k5-Bmacs%7EH-9kr%7E2%7E5g2Fra&amp;traceid=54784D01&amp;callback=parent.bd__pcbs__t0v21n
</code></pre></div><p>​	请求method必须为大写，现在一般只使用GET和POST，所有方法的说明如下：</p> <p>​	http响应：由三部分组成，响应行、响应头和响应体</p> <p>​	示例（百度登录返回）：</p> <div class="language- extra-class"><pre class="language-text"><code>HTTP/1.1 200 OK
Access-Control-Expose-Headers: Trace-ID
Cache-Control: public
Connection: keep-alive
Content-Encoding: gzip
Content-Type: text/html
Date: Sat, 10 Feb 2018 12:38:17 GMT
Expires: 0
Last-Modified: Sat, 10 Feb 2018 12:38:16 12FebGMT
P3p: CP=&quot; OTI DSP COR IVA OUR IND COM &quot;
Pragma: public
Server: Apache
Strict-Transport-Security: max-age=31536000
Trace-Id: 54784D01
Tracecode: 22969190170312486410021020
Tracecode: 22969190170969169930021020
Vary: Accept-Encoding
Transfer-Encoding: chunked

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script type=&quot;text/javascript&quot;&gt;


	var href = decodeURIComponent(&quot;https:\/\/www.baidu.com\/cache\/user\/html\/v3Jump.html&quot;)+&quot;?&quot;

var accounts = '&amp;accounts='

href += &quot;err_no=7&amp;callback=parent.bd__pcbs__t0v21n&amp;codeString=jxG9007e2f71134c1fc023315e99801277b88a24406f10431e8&amp;userName=mumuloveshine&amp;phoneNumber=&amp;mail=&amp;hao123Param=&amp;u=https://www.baidu.com/%3Ftn%3D93882546_hao_pg&amp;tpl=mn&amp;secstate=&amp;gotourl=&amp;authtoken=&amp;loginproxy=&amp;resetpwd=0&amp;vcodetype=ae20DiYV\/qLGUUeTvt6K91W\/neFrpV1ec8WRrh0h9nSGenOd1efhUH8uDb8AFNyOeVu8G9EJLOnD1f97a3jzAj1o7zbXVVlMs3nq&amp;lstr=&amp;ltoken=&amp;bckv=&amp;bcsync=&amp;bcchecksum=&amp;code=&amp;bdToken=&amp;realnameswitch=&amp;setpwdswitch=&amp;bctime=&amp;bdstoken=&amp;authsid=&amp;jumpset=&amp;appealurl=&amp;realnameverifyemail=0&amp;traceid=54784D01&amp;realnameauthsid=&quot;+accounts;


if(window.location){
    window.location.replace(href);
}else{
   document.location.replace(href); 
}
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h6 id="_4、服务器相关协议"><a href="#_4、服务器相关协议" class="header-anchor">#</a> 4、服务器相关协议</h6> <p>​	web协议，是web服务器和web请求处理程序之间传输数据的一种标准协议，发展史为：</p> <p>CGI -&gt; FCGI -&gt; WSGI</p> <p>​	说明如下：</p> <ul><li><p>CGI：通用网关接口（Common Gateway Interface/CGI），最早的web协议</p></li> <li><p>FCGI：Fast CGI，在CGI基础上，提高了服务性能</p></li> <li><p>WSGI：Web Server Gateway Interface，专用于python程序，在CGI的基础上改进的协议</p></li> <li><p>uwsgi：uWSGI服务程序自有的协议（不是一个web协议），常用于在uWSGI服务器与其他网络服务器程序的数据通信，与WSGI没有关系。</p> <p>​	uWSGI是一个Web服务器程序，它实现了WSGI、uwsgi、http等协议。uWSGI起何作用，取决于架构方式：</p> <ul><li>如果架构是Nginx+uWSGI+Django， 那么uWSGI是一个中间件</li> <li>如果架构是uWSGI+Django，那么uWSGI是一个web服务器</li></ul></li></ul> <h6 id="_5、nginx服务器"><a href="#_5、nginx服务器" class="header-anchor">#</a> 5、nginx服务器</h6> <p>​	nginx是一个高性能的HTTP和反向代理服务器。</p> <p>​	什么是正向代理、反向代理？</p> <ol><li>正向代理，例如平时我们使用的加速器、翻墙等代理就是正向代理，客户机请求代理服务器，代理服务器转发请求到对应的目标服务器</li> <li>反向代理，部署在Web服务器上，代理所有外部网络对内部网络的访问。浏览器访问服务器，必须经过这个代理，是被动的。</li></ol> <p>​	正向代理的主动方是客户端，反向代理的主动方是Web服务器。</p> <p>​</p> <p>​	反向代理的作用：</p> <ol><li>安全，客户端对Web服务器的访问需要先经过反向代理服务器。这样可以防止外部程序对Web服务器的直接攻击。</li> <li>负载均衡，反向代理服务器可以根据Web服务器的负载情况，动态地把HTTP请求交给不同的Web服务器来处理，前提是要有多个Web服务器。</li> <li>提升Web服务器的IO性能。一个HTTP请求的数据，从客户端传输给服务器，是需要时间的，例如N秒，如果直接传给Web服务器，Web服务器就需要让一个进程阻塞N秒，来接收IO，这样会降低Web服务器的性能。如果使用反向代理服务器，先让反向代理服务器接收完整个HTTP请求，再把请求发给Web服务器，就能提升Web服务器的性能。还有一些静态文件的请求，可以直接交给反向代理来处理，不需要经过Web服务器。</li></ol> <h4 id="_3、生命周期分析"><a href="#_3、生命周期分析" class="header-anchor">#</a> 3、生命周期分析</h4> <h6 id="_1、客户端发送请求"><a href="#_1、客户端发送请求" class="header-anchor">#</a> 1、客户端发送请求</h6> <ol><li>在浏览器输入url，譬如www.baidu.com，浏览器会自动补全协议（http），变为http://www.baidu.com，现在部分网站都实现了HSTS机制，服务器自动从http协议重定向到https协议</li> <li>在网页中点击超链接或javascript脚本进行url跳转，仅设置 href=‘绝对路径’，浏览器会自动使用当前url的协议、host和port，譬如在 https://tieba.baidu.com/index.html网页中，点击一个超链接 /f?kw=chinajoy ， 会自动访问 https://tieba.baidu.com/f?kw=chinajoy</li></ol> <h6 id="_2、路由转发"><a href="#_2、路由转发" class="header-anchor">#</a> 2、路由转发</h6> <ol><li>IP查找：因特网内每个公有IP都是唯一的，域名相当于IP的别名，因为我们无法去记住一大堆无意义的IP地址，但如果用一堆有意义的字母组成，大家就能快速访问对应网站</li> <li>DNS解析：通过域名去查找IP，先从本地缓存查找，其中本地的hosts文件也绑定了对应IP，若在本机中无法查到，那么就会去请求本地区域的域名服务器（通常是对应的网络运营商如电信），这个通过网络设置中的LDNS去查找，如果还是没有找到的话，那么就去根域名服务器查找，这里有所有因特网上可访问的域名和IP对应信息（根域名服务器全球共13台）</li> <li>路由转发：通过网卡、路由器、交换机等设备，实现两个IP地址之间的通信。用到的主要就是路由转发技术，根据路由表去转发报文，还有子网掩码、IP广播等等知识点</li></ol> <h6 id="_3、建立连接"><a href="#_3、建立连接" class="header-anchor">#</a> 3、建立连接</h6> <p>​	通过TCP协议的三次握手建立连接</p> <h6 id="_4、传输报文"><a href="#_4、传输报文" class="header-anchor">#</a> 4、传输报文</h6> <p>​	建立连接后，客户端会通过TCP依次、有序的发送一定大小的报文，其中包括了超时重传、阻塞窗口等等概念，用来保证数据包的完整、有序</p> <ul><li>http协议使用的明文传输，所有内容都是直接可读的</li> <li>https协议是基于SSL/TLS加密，而SSL/TLS是基于TCP协议的，也就是http协议报文包装成TCP报文进行的加密，使用https协议的话，如果本地没有证书和公钥，那么会从服务器获取证书并且进行验证，流程如下：</li></ul> <h6 id="_5、nginx处理"><a href="#_5、nginx处理" class="header-anchor">#</a> 5、nginx处理</h6> <p>​	当前django框架开发的web项目，主流使用的服务器架构是：nginx+uWSGI+django，本文档就以此种架构方式做分析。</p> <p>​	nginx监听公网IP的某个端口，譬如80，接收到请求后，分2种情况处理请求：</p> <ol><li>如果是静态资源（如javascript、css、图片等）的请求，那么nginx直接获取到该资源，返回给用户</li> <li>如果是动态内容的请求，那么nginx就将请求转发到uWSGI，使用的协议一般都是uwsgi，性能最好</li></ol> <p>PS：</p> <ul><li>有些reqeust会分多个数据包进行发送，nginx会缓存等待整个request接收完成才调用uWSGI</li> <li>如果使用的https，那么加密、解密都在nginx中进行处理</li></ul> <h6 id="_6、uwsgi处理"><a href="#_6、uwsgi处理" class="header-anchor">#</a> 6、uWSGI处理</h6> <p>​	uWSGI监听本机IP的某个端口，譬如3308，接收到nginx转发来的请求后，通过将http协议转换为WSGI协议，和django程序之间进行通信</p> <p>​</p> <h6 id="_7、wsgihandler处理"><a href="#_7、wsgihandler处理" class="header-anchor">#</a> 7、WSGIHandler处理</h6> <p>​	当django接受到一个请求时，会初始化一个WSGIHandler，可以在项目下的wsgi.py文件进行跟踪查看：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">WSGIHandler</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span>BaseHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    request_class <span class="token operator">=</span> WSGIRequest

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>load_middleware<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        set_script_prefix<span class="token punctuation">(</span>get_script_name<span class="token punctuation">(</span>environ<span class="token punctuation">)</span><span class="token punctuation">)</span>
        signals<span class="token punctuation">.</span>request_started<span class="token punctuation">.</span>send<span class="token punctuation">(</span>sender<span class="token operator">=</span>self<span class="token punctuation">.</span>__class__<span class="token punctuation">,</span> environ<span class="token operator">=</span>environ<span class="token punctuation">)</span>
        request <span class="token operator">=</span> self<span class="token punctuation">.</span>request_class<span class="token punctuation">(</span>environ<span class="token punctuation">)</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>get_response<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>它接受2个参数：</p> <ul><li>environ：是含有服务器端的环境变量</li> <li>start_response：可调用对象，返回一个可迭代对象。</li></ul> <p>这个handler控制了从请求到响应的整个过程，首先的就是加载django的settings配置，然后就是调用django的中间件开始操作</p> <h6 id="_8、middleware的process-request"><a href="#_8、middleware的process-request" class="header-anchor">#</a> 8、middleware的process_request</h6> <p>​	中间件的process_request方法列表对request对象进行处理</p> <p>​</p> <p>​	django项目默认有一些自带的中间件，如下：</p> <div class="language-python extra-class"><pre class="language-python"><code>MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.middleware.security.SecurityMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.common.CommonMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>​	一般情况下这些中间件都会启用，如果需要增加自定义的中间件（该中间件类必须继承MiddlewareMixin），一般是添加在系统的中间件之下，如：</p> <div class="language-python extra-class"><pre class="language-python"><code>MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.middleware.security.SecurityMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.common.CommonMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="token punctuation">,</span>
    
    <span class="token comment">## 自定义中间层</span>
    <span class="token string">'my_app.middleware.MyMiddleware'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>​</p> <p>​	中间件中主要有以下方法（一个中间件类最少需要实现下列方法中的一个）：</p> <ul><li><p>process_request：处理请求对象</p> <p>参数：request</p> <p>返回：</p> <ul><li>response：调用process_response列表处理</li> <li>None：调用下一个中间件的process_request处理</li></ul></li> <li><p>process_response：处理响应对象</p> <p>参数：request, response</p> <p>返回：</p> <ul><li>response：调用上一个中间件的process_response处理</li></ul></li> <li><p>process_view：视图预处理，在视图函数处理之前调用</p> <p>参数：request，view_func，view_args，view_kwargs</p> <p>​	view_func：url路由匹配到的视图函数</p> <p>​	view_args：视图函数的可变参数</p> <p>​	view_kwargs：视图函数的可变关键字参数</p> <p>返回：</p> <ul><li>response：调用process_response处理</li> <li>None：调用下一个中间件的process_view处理</li></ul></li> <li><p>process_exception：在视图函数或中间件处理过程抛出异常时调用</p> <p>参数：request，exception</p> <p>​	exception：是处理过程中抛出的异常对象</p> <p>返回：</p> <ul><li>response：之后的process_exception都不会触发，而是调用process_response处理</li> <li>None：调用上一个中间件的process_exception处理</li></ul></li> <li><p>process_template_response：在视图函数完成操作后调用，默认不执行，除非视图函数返回的response中有render方法</p> <p>参数：request，response</p> <p>​	response：不是HttpReponse，而是SimpleTemplateResponse对象，具有render方法</p> <p>返回：</p> <ul><li><p>response：SimpleTemplateResponse对象，调用上一个中间件的process_template_response处理，最后一个process_template_response处理完成后，会自动调用 response对象中的render方法，得到一个HttpResponse对象，进行返回，再调用process_response操作</p> <p>中间件方法的执行时有顺序的，process_request与process_view是按照顺序去执行的，而process_response、process_exception和process_template_response是反序的 ：</p></li></ul></li></ul> <p>​</p> <h6 id="_9、urlconf路由匹配"><a href="#_9、urlconf路由匹配" class="header-anchor">#</a> 9、URLConf路由匹配</h6> <p>​	通过urls.py文件中的 urlpatterns 配置找到对应的 视图函数或者视图类的方法，如果没有找到匹配的方法，那么就会触发异常，由中间件的process_exception 进行处理</p> <h6 id="_10、middleware的process-view"><a href="#_10、middleware的process-view" class="header-anchor">#</a> 10、middleware的process_view</h6> <p>​	调用中间件的 process_view 方法进行预处理</p> <h6 id="_11、views处理request"><a href="#_11、views处理request" class="header-anchor">#</a> 11、views处理request</h6> <p>​	调用对应的视图函数或视图类的方法处理request，譬如获取GET和POST参数，并且调用特定的模型对象执行数据库操作，如果没有数据库操作，那么就直接跳到我们后续的14步了</p> <h6 id="_12、models处理"><a href="#_12、models处理" class="header-anchor">#</a> 12、models处理</h6> <p>​	视图方法中，一般情况下都需要调用模型类进行数据操作，一般是通过模型的manager管理类进行操作的，如：MyModel.objects.get(pk=1)</p> <p>​	如果没有数据操作，那么这一步和下一步就忽略</p> <h6 id="_13、数据库操作"><a href="#_13、数据库操作" class="header-anchor">#</a> 13、数据库操作</h6> <p>​	如果django通过模型类执行对数据库的增删改查，那么此时整个流程就会在对应的数据库中执行</p> <h6 id="_14、views处理数据"><a href="#_14、views处理数据" class="header-anchor">#</a> 14、views处理数据</h6> <p>​	视图方法获取到数据后：</p> <ul><li>将数据封装到一个context字典当中，然后调用指定的template.html，通过模板中的变量、标签和过滤器等，再结合传入的数据context，会触发中间件的process_template_response方法，最终渲染成HttpResponse</li> <li>不调用模板，直接返回数据，譬如 JsonResponse、FileResponse等</li> <li>执行redirect，生成一个重定向的HttpResponse，触发中间件的process_response后，返回到客户端，结束该web请求的生命周期</li></ul> <h6 id="_15、middleware的process-response"><a href="#_15、middleware的process-response" class="header-anchor">#</a> 15、middleware的process_response</h6> <p>​	调用中间件的 process_response 方法进行处理，最后一个中间件的process_response执行完成后，返回到WSGIHandler类中</p> <p>​	至此，django编程的处理部分完毕</p> <h6 id="_16、wsgihandler处理"><a href="#_16、wsgihandler处理" class="header-anchor">#</a> 16、WSGIHandler处理</h6> <p>​	WSGIHandler类获取到response后</p> <ul><li>先处理response的响应行和响应头，然后调用 start_response 返回http协议的 响应行和响应头 到uWSGI，这个 start_response 只能调用一次</li> <li>第一步处理完成后，如果是文件需要对response进行，否则就直接将response作为http协议的body部分返回给uWSGI</li></ul> <h6 id="_17、uwsgi处理"><a href="#_17、uwsgi处理" class="header-anchor">#</a> 17、uWSGI处理</h6> <p>​	uWSGI接收到django程序的返回后，将所有内容包装成http协议的内容后，通过uwsgi协议返回给nginx服务器处理</p> <h6 id="_18、nginx处理"><a href="#_18、nginx处理" class="header-anchor">#</a> 18、nginx处理</h6> <p>​	nginx获取到uWSGI的返回后，将response通过TCP协议返回给客户端</p> <h6 id="_19、客户端接收响应"><a href="#_19、客户端接收响应" class="header-anchor">#</a> 19、客户端接收响应</h6> <p>​	客户端接收到服务器的响应后，做对应的操作，譬如：显示在浏览器中，或是javascript的处理等</p> <p>​	至此，整个web请求的生命周期结束。</p> <p>​</p> <h6 id=""><a href="#" class="header-anchor">#</a></h6></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/django-content/11-分页器.html" class="prev">
        分页器
      </a></span> <span class="next"><a href="/notes/django-content/13-验证码.html">
        验证码
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.693f674f.js" defer></script><script src="/notes/assets/js/2.ee803d5e.js" defer></script><script src="/notes/assets/js/32.f91948f2.js" defer></script>
  </body>
</html>
