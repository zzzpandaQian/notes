(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{392:function(t,a,s){"use strict";s.r(a);var n=s(41),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"文件云存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件云存储"}},[t._v("#")]),t._v(" 文件云存储")]),t._v(" "),s("h2",{attrs:{id:"_1、概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、概述"}},[t._v("#")]),t._v(" 1、概述")]),t._v(" "),s("p",[t._v("​\t在django项目中，用户上传的文件以及项目中使用的静态文件，默认都是本地存储，保存在服务器中，但是其实我们也可以将它们都保存在云存储中，譬如七牛云存储、阿里云存储、亚马逊云存储等。")]),t._v(" "),s("p",[t._v("​\t本文档使用 七牛云存储")]),t._v(" "),s("h2",{attrs:{id:"_2、本地存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、本地存储"}},[t._v("#")]),t._v(" 2、本地存储")]),t._v(" "),s("h3",{attrs:{id:"_1、建立项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、建立项目"}},[t._v("#")]),t._v(" 1、建立项目")]),t._v(" "),s("p",[t._v("​\t新建django项目，然后：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("配置数据库")])]),t._v(" "),s("li",[s("p",[t._v("建立模型")])])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UploadFileImg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FileField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("upload_to"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'files/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ImageField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("upload_to"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'imgs/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    remark "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CharField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("max_length"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("说明：\n模型中文件的处理主要是2个字段类：")]),t._v(" "),s("ul",[s("li",[t._v("FileField：用于一般文件")]),t._v(" "),s("li",[t._v("ImageField：用于图片文件")])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("迁移数据库")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("python manage.py makemigrations\n\npython manage.py migrate\n")])])]),s("h3",{attrs:{id:"_2、settings"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、settings"}},[t._v("#")]),t._v(" 2、settings")]),t._v(" "),s("p",[t._v("settings.py：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("MEDIA_URL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/media/'")]),t._v("\n\nMEDIA_ROOT "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BASE_DIR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'media'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("说明：")]),t._v(" "),s("ul",[s("li",[t._v("MEDIA_URL： 在url中访问的path的开头")]),t._v(" "),s("li",[t._v("MEDIA_ROOT：文件存储的位置，一般设置在根目录下的 media 文件夹中，别忘记建立对应的目录")])]),t._v(" "),s("h3",{attrs:{id:"_3、根urls"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、根urls"}},[t._v("#")]),t._v(" 3、根urls")]),t._v(" "),s("p",[t._v("​\t需要在 url 中访问文件，那么需要在 根urls 中增加以下代码：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" settings\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urls"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("static "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" static\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" settings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEBUG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    urlpatterns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" static"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("settings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MEDIA_URL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" document_root"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("settings"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MEDIA_ROOT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_4、admin管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、admin管理"}},[t._v("#")]),t._v(" 4、admin管理")]),t._v(" "),s("p",[t._v("​\t在 admin 中进行管理，那么会自动配置使用 模型字段中的 upload_to 进行文件保存")]),t._v(" "),s("h4",{attrs:{id:"_1-admin管理模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-admin管理模型"}},[t._v("#")]),t._v(" 1. admin管理模型")]),t._v(" "),s("p",[t._v("在admin中：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("admin.site.register(UploadFileImg)\n")])])]),s("h4",{attrs:{id:"_2-在admin后台中添加数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-在admin后台中添加数据"}},[t._v("#")]),t._v(" 2.在admin后台中添加数据")]),t._v(" "),s("h4",{attrs:{id:"_3-前端显示和下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-前端显示和下载"}},[t._v("#")]),t._v(" 3.前端显示和下载")]),t._v(" "),s("p",[t._v("urls：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'file_admin/<int:pk>/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" views"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("file_admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("模板：在 templates/file_app/file_admin.html ：")]),t._v(" "),s("div",{staticClass:"language-django extra-class"},[s("pre",{pre:!0,attrs:{class:"language-django"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("admin管理的文件显示"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            备注："),s("span",{pre:!0,attrs:{class:"token django language-django"}},[s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("{{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("uploadFileImg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("remark")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("}}")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            图片名："),s("span",{pre:!0,attrs:{class:"token django language-django"}},[s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("{{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("uploadFileImg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("img")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("}}")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token django language-django"}},[s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("{{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("uploadFileImg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("img")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("url")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("}}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token django language-django"}},[s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("{{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("uploadFileImg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("url")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("}}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token django language-django"}},[s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("{{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("uploadFileImg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("}}")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("说明：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("uploadFileImg.file.url 和 uploadFileImg.img.url 用于获取 文件的url，会自动加上settings中配置的MEDIA_URL")])]),t._v(" "),s("li",[s("p",[t._v("uploadFileImg.file.name 和 uploadFileImg.img.name 用于获取 文件名")])]),t._v(" "),s("li",[s("p",[t._v("通过 a 标签的 href 指定 url，即可实现文件的下载")])])]),t._v(" "),s("p",[t._v("views：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file_admin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        uploadFileImg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UploadFileImg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pk"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" render"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'file_app/file_admin.html'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uploadFileImg'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" uploadFileImg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" Http404\n")])])]),s("h2",{attrs:{id:"_3、七牛云存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、七牛云存储"}},[t._v("#")]),t._v(" 3、七牛云存储")]),t._v(" "),s("h3",{attrs:{id:"_1、注册七牛"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、注册七牛"}},[t._v("#")]),t._v(" 1、注册七牛")]),t._v(" "),s("ol",[s("li",[t._v("注册 https://www.qiniu.com/")]),t._v(" "),s("li",[t._v("登录后，访问 个人中心 >> 秘钥管理 ，可以查看到2个key：\n"),s("ul",[s("li",[t._v("AK：ziOjcE7RNZCxwZfOW3WbQzBEHqeN48BLSBcv9uFN")]),t._v(" "),s("li",[t._v("SK：B7A1pkm76FE78jlrVTXYSa2qm7zOPWoqGzNvKcs6")])])]),t._v(" "),s("li",[t._v("进行实名认证")]),t._v(" "),s("li",[t._v("在 对象存储 中，创建 存储空间，得到2个key： 空间名（自己设置，譬如：cloud）、域名(譬如：pxcmwimcw.bkt.clouddn.com)")])]),t._v(" "),s("h3",{attrs:{id:"_2、安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装"}},[t._v("#")]),t._v(" 2、安装")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("pip install django-qiniu-storage==2.3.1\n")])])]),s("h3",{attrs:{id:"_3、settings"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、settings"}},[t._v("#")]),t._v(" 3、settings")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对应 秘钥管理中的 AK")]),t._v("\nQINIU_ACCESS_KEY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ziOjcE7RNZCxwZfOW3WbQzBEHqeN48BLSBcv9uFN'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对应 秘钥管理中的 SK")]),t._v("\nQINIU_SECRET_KEY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'B7A1pkm76FE78jlrVTXYSa2qm7zOPWoqGzNvKcs6'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对应 存储空间 中的 空间名")]),t._v("\nQINIU_BUCKET_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cloud'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对应 存储空间 的域名")]),t._v("\nQINIU_BUCKET_DOMAIN "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pxcmwimcw.bkt.clouddn.com'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用http")]),t._v("\nQINIU_SECURE_URL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# URL的 scheme 前缀")]),t._v("\nPREFIX_URL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件存储的 前置path")]),t._v("\nMEDIA_ROOT "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/media/'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件的URL前缀")]),t._v("\nMEDIA_URL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" PREFIX_URL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" QINIU_BUCKET_DOMAIN "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" MEDIA_ROOT\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改 默认的文件存储类")]),t._v("\nDEFAULT_FILE_STORAGE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'qiniustorage.backends.QiniuMediaStorage'")]),t._v("\n")])])]),s("p",[t._v("说明：")]),t._v(" "),s("p",[t._v("其他的配置项都是七牛云存储私有的，和普通的本地存储的区别就是3个参数的修改：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("MEDIA_ROOT：从普通的：os.path.join(BASE_DIR, 'media') 修改为  '/media/' ，那么存储的默认位置就是 QINIU_BUCKET_DOMAIN + MEDIA_ROOT")])]),t._v(" "),s("li",[s("p",[t._v("MEDIA_URL：  从普通的 '/media/' 修改为 PREFIX_URL + QINIU_BUCKET_DOMAIN + MEDIA_ROOT， 由于使用七牛云存储，因此和我们本身项目的域名不同，因此只能使用绝对路径，而不是普通存储那样的相对路径")])]),t._v(" "),s("li",[s("p",[t._v("DEFAULT_FILE_STORAGE： 这个是重点，因为最终文件的存储，就是由这个类实现的，从默认的 本地存储类修改为 七牛云的存储类，七牛的存储类有3种：")]),t._v(" "),s("ul",[s("li",[t._v("qiniustorage.backends.QiniuStorage：文件将存放在bucket的根目录下")]),t._v(" "),s("li",[t._v("qiniustorage.backends.QiniuMediaStorage：文件将存放在bucket/MEDIA_ROOT目录下")]),t._v(" "),s("li",[t._v("qiniustorage.backends.QiniuStaticStorage：文件将存放在bucket/STATIC_ROOT目录下")])])])]),t._v(" "),s("h3",{attrs:{id:"_4、测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、测试"}},[t._v("#")]),t._v(" 4、测试")]),t._v(" "),s("p",[t._v("​\t在admin后台增加数据，并且在前端显示，这些代码都不需要做任何修改即可")]),t._v(" "),s("h2",{attrs:{id:"_4、七牛云存储静态文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、七牛云存储静态文件"}},[t._v("#")]),t._v(" 4、七牛云存储静态文件")]),t._v(" "),s("p",[t._v("​\t在项目中我们也可以使用云存储保存我们的所有静态文件，只需要几步即可实现")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("settings：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在云存储中保存的文件前置path")]),t._v("\nSTATIC_ROOT "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/static/'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 静态文件的url访问路径前置path")]),t._v("\nSTATIC_URL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" QINIU_BUCKET_DOMAIN "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" STATIC_ROOT\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 静态文件存储使用的 存储类")]),t._v("\nSTATICFILES_STORAGE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'qiniustorage.backends.QiniuStaticStorage'")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("在cmd执行命令：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("python manage.py collectstatic\n")])])]),s("p",[t._v("说明：")]),t._v(" "),s("p",[t._v("如果出现提示，需要覆盖文件，输入 yes 按回车")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);