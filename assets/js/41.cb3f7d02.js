(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{391:function(t,s,a){"use strict";a.r(s);var n=a(41),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"项目部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目部署"}},[t._v("#")]),t._v(" 项目部署")]),t._v(" "),a("h2",{attrs:{id:"一、项目部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、项目部署"}},[t._v("#")]),t._v(" 一、项目部署")]),t._v(" "),a("p",[t._v("####1、概述")]),t._v(" "),a("p",[t._v("​\t项目部署就是将开发完成的Django项目部署到指定的服务器上，而服务器的系统基本都是linux。")]),t._v(" "),a("p",[t._v("​\tDjango项目当前最主要的部署方式是：Python+Django+Nginx+uWSGI")]),t._v(" "),a("ul",[a("li",[t._v("python：是python程序运行的环境")]),t._v(" "),a("li",[t._v("Django：是项目开发的主要框架，也特指我们开发的django项目")]),t._v(" "),a("li",[t._v("Nginx：反向代理服务器，用于实现对用户请求的转发，转发给uWSGI，主要实现3个功能：\n"),a("ul",[a("li",[t._v("反向代理")]),t._v(" "),a("li",[t._v("动静分离")]),t._v(" "),a("li",[t._v("负载均衡")])])]),t._v(" "),a("li",[t._v("uWSGI：python的web服务器，使用WSGI协议和django项目交互，使用uwsgi协议和nginx进行通信")])]),t._v(" "),a("h4",{attrs:{id:"_2、环境介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、环境介绍"}},[t._v("#")]),t._v(" 2、环境介绍")]),t._v(" "),a("p",[t._v("​\t本文中使用的环境为：")]),t._v(" "),a("ul",[a("li",[t._v("centos7")]),t._v(" "),a("li",[t._v("python3.6.5")]),t._v(" "),a("li",[t._v("django2.2")]),t._v(" "),a("li",[t._v("nginx1.14.0")]),t._v(" "),a("li",[t._v("uWSGI2.0.18")])]),t._v(" "),a("h4",{attrs:{id:"_3、安装python"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、安装python"}},[t._v("#")]),t._v(" 3、安装python")]),t._v(" "),a("p",[t._v("1、 如果没有安装wget，使用以下命令安装：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum -y install wget\n")])])]),a("p",[t._v("2、 访问 "),a("a",{attrs:{href:"https://www.python.org/ftp/python/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.python.org/ftp/python/"),a("OutboundLink")],1),t._v(" 查找需要下载的python版本，譬如：Python-3.6.5.tgz")]),t._v(" "),a("p",[t._v("或者使用window下载后传送到centos中，或者直接使用以下命令下载")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz\n")])])]),a("p",[t._v("​       PS：没有设置下载目录的话，文件会下载在当前目录")]),t._v(" "),a("p",[t._v("3、 安装编译器gcc：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install gcc\n\nyum install gcc-c++\n")])])]),a("p",[t._v("4、 执行解压：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("tar -zxvf Python-3.6.5.tgz\n")])])]),a("p",[t._v("5、 移动文件夹到指定目录/usr/local/：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mv Python-3.6.5 /usr/local/\n")])])]),a("p",[t._v("6、 进入到指定目录：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd /usr/local/Python-3.6.5\n")])])]),a("p",[t._v("7、 修改Setup：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi Modules/Setup.dist\n")])])]),a("p",[t._v("修改结果如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("## Socket module helper for socket(2)  \n_socket socketmodule.c timemodule.c  \n  \n## Socket module helper for SSL support; you must comment out the other  \n## socket line above, and possibly edit the SSL variable:  \n##SSL=/usr/local/ssl  \n_ssl _ssl.c \\  \n-DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \\  \n-L$(SSL)/lib -lssl -lcrypto  \n\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("p",[t._v("最下面的3行，本来是被注释的，需要将注释去掉")]),t._v(" "),a("p",[t._v("8、 安装zlib依赖包：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install zlib*\n")])])]),a("p",[t._v("9、 安装sqlite3：")]),t._v(" "),a("p",[t._v("直接使用以下命令安装，会安装 sqlite-devel-3.7.17-8.el7.x86_64 版本")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install sqlite-devel\n")])])]),a("p",[t._v("而我们django2.2的版本需要 sqlite3.8.3 或以上版本，因此需要手动安装sqlite3")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('## wget 命令安装\n## 也可以在windows中下载之后发送到linux中\nwget https://www.sqlite.org/2019/sqlite-autoconf-3270200.tar.gz\n\ntar -zxvf sqlite-autoconf-3270200.tar.gz\n\ncd sqlite-autoconf-3270200\n\n## 执行配置\n./configure --prefix=/usr/local\n\n## 编译并且安装， 可能会比较耗时\nmake && make install\n\n## 查看安装结果\nfind /usr/ -name sqlite3\n\n## 查看安装版本\n/usr/local/bin/sqlite3 --version\n\n## 删除安装包\ncd ..\nrm sqlite-autoconf-3270200.tar.gz\nrm sqlite-autoconf-3270200\n\n## 现有版本\n/usr/bin/sqlite3 --version\n\n## 移除现有链接\nmv /usr/bin/sqlite3  /usr/bin/sqlite3_old\n\n## 添加新的版本的链接\nln -s /usr/local/bin/sqlite3   /usr/bin/sqlite3\n\n## 将路径传递给共享库, 如果想开机自动运行，则将下面的代码写入到 ~/.bashrc 文件中，文件配置立即生效使用：source ~/.bashrc\nexport LD_LIBRARY_PATH="/usr/local/lib"\n')])])]),a("p",[t._v("10、安装ssl：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install openssl -y\nyum install openssl-devel -y\n\n")])])]),a("p",[t._v("11、执行配置：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("./configure --prefix=/usr/local/python36 --with-ssl CFLAGS=-fPIC\n")])])]),a("p",[t._v("12、执行编译：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("make\n")])])]),a("p",[t._v("PS：会比较耗时")]),t._v(" "),a("p",[t._v("13、执行编译安装：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("make install\n")])])]),a("p",[t._v("PS：会比较耗时")]),t._v(" "),a("p",[t._v("14、创建链接：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ln -s /usr/local/python36/bin/python3.6 /usr/bin/python3\n\nln -s /usr/local/python36/bin/pip3.6 /usr/bin/pip3\n")])])]),a("p",[t._v("PS：记住 ln 中的 l 是 L 的小写，不是 i 的大写")]),t._v(" "),a("p",[t._v("centos中默认安装有python2.7，在系统中链接为 python2和python")]),t._v(" "),a("p",[t._v("我们可以删除现有python2链接：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("rm -rf /usr/bin/python\n")])])]),a("p",[t._v("然后创建python3.6.5的链接为python")]),t._v(" "),a("p",[t._v("但是不推荐，因为很多命令都会依赖python，一旦修改为python3了，会有各种的错误产生")]),t._v(" "),a("p",[t._v("15、查看安装结果：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("pip3 -V\n\npython3 -V\n")])])]),a("h4",{attrs:{id:"_4、django程序处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、django程序处理"}},[t._v("#")]),t._v(" 4、Django程序处理")]),t._v(" "),a("p",[t._v("​\t假设我们的django项目已经开发完毕")]),t._v(" "),a("h6",{attrs:{id:"_1、通用配置修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、通用配置修改"}},[t._v("#")]),t._v(" 1、通用配置修改")]),t._v(" "),a("p",[t._v("settings.py：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("DEBUG "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n\nALLOWED_HOSTS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nDATABASES "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ENGINE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'django.db.backends.mysql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NAME'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'blog'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'USER'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PASSWORD'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nihaoma0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HOST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.107.107'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PORT'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3306'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("修改DEBUG为False，同时必须配置 ALLOWED_HOSTS ，内容是允许访问的域名列表，使用 * 表示通配符")]),t._v(" "),a("li",[t._v("修改数据库连接为 生产环境 下使用的")])]),t._v(" "),a("h6",{attrs:{id:"_2、静态文件处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、静态文件处理"}},[t._v("#")]),t._v(" 2、静态文件处理")]),t._v(" "),a("p",[t._v("settings.py：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## url中访问静态文件的url起始path")]),t._v("\nSTATIC_URL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/static/'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 合并后的静态文件目录的绝对路径，需要在根目录添加 static 目录")]),t._v("\nSTATIC_ROOT "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BASE_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'static'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 以下不是必须的， 扩展的静态文件地址，需要添加 common_static 目录")]),t._v("\nSTATICFILES_DIRS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BASE_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'common_static'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("主要需要添加 STATIC_ROOT 配置，用于部署后，合并各个子应用下的静态文件")]),t._v(" "),a("li",[t._v("部署后，别忘记使用 "),a("code",[t._v("python manage.py collectstatic")]),t._v("命令，合并各个子应用下的静态文件，然后在 处理静态文件的服务器中（如nginx）配置到该路径")])]),t._v(" "),a("h6",{attrs:{id:"_3、python环境处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、python环境处理"}},[t._v("#")]),t._v(" 3、python环境处理")]),t._v(" "),a("p",[t._v("在django项目的根目录，生成一个 requirements.txt")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("## 如果使用的第三方库比较少，那么可以手写一个 requirements.txt\n## 如果使用的第三方库较多，那么就使用以下命令：\npip freeze > requirements.txt\n\n## 拷贝上述的文件到服务器中，并且执行以下命令安装环境\npip3 install -r requirements.txt\n\n")])])]),a("h6",{attrs:{id:"_4、复制项目文件到服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、复制项目文件到服务器"}},[t._v("#")]),t._v(" 4、复制项目文件到服务器")]),t._v(" "),a("p",[t._v("将项目拷贝linux系统中（譬如FTP），然后移动到 /var/www/ 目录下")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mv /ftp/childrenshop /var/www/\n")])])]),a("p",[t._v("PS：拷贝完成后，记得执行合并static的命令"),a("code",[t._v("python manage.py collectstatic")])]),t._v(" "),a("h4",{attrs:{id:"_5、安装和使用uwsgi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、安装和使用uwsgi"}},[t._v("#")]),t._v(" 5、安装和使用uWSGI")]),t._v(" "),a("p",[t._v("1、 uwsgi官方文档：http://uwsgi-docs.readthedocs.io/en/latest/tutorials/Django_and_nginx.html")]),t._v(" "),a("p",[t._v("2、 在生产环境中，使用虚拟环境，一般我们的linux中，会有2套 python，一个是系统自带的python2，一个是我们的项目环境所需的python3")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("##使用以下命令查看\npython2 -V\npython3 -V \n\n")])])]),a("p",[t._v("3、 在环境中安装项目所需第三方库，假定当前djang项目（项目名：childrenshop）已经拷贝到 /var/www 目录下，并且目录中已经有  requirements.txt 文件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("## 切换到 项目路径\ncd /var/www/children\n\n## 安装环境\npip3 install -r requirements.txt -i http://pypi.douban.com/simple --trusted-host pypi.douban.com\n\n")])])]),a("p",[t._v("4、 使用 pip 安装uwsgi")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("pip3 install uwsgi==2.0.18 -i http://pypi.douban.com/simple --trusted-host pypi.douban.com\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("-i ： 指定镜像源的网址，这里使用的豆瓣")]),t._v(" "),a("li",[t._v("--trusted-host ： 信任 -i 指定的网站，不进行信任的话，会出现SSL错误")])]),t._v(" "),a("p",[t._v("5、 测试uwsgi")]),t._v(" "),a("p",[t._v("编写一个测试的py文件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi test.py\n")])])]),a("p",[t._v("​       文件内容如下：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##!/usr/bin/env python3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## coding:utf-8")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("start_response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    start_response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'200 OK'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Welcome to use uwsgi!!!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[t._v("​       运行：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/usr/local/python36/bin/uwsgi --http 0.0.0.0:8997 --wsgi-f /var/www/childrenshop/\ttest.py\n这里的路径应修改为实际情况\n")])])]),a("p",[t._v("注意：")]),t._v(" "),a("p",[t._v("由于我们需要从本机访问linux的8997端口，因此需要设置linux的防火墙：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("centos 》 7.0\n## 开放8997端口\nfirewall-cmd --zone=public --add-port=8997/tcp --permanent\n\n## 删除端口\nfirewall-cmd --zone=public --remove-port=8997/tcp\n\n## 重启防火墙\nfirewall-cmd --reload\n\n## 查看防火墙状态\nfirewall-cmd --list-all\n\ncentos < 7.0\nvi /etc/sysconfig/iptables\n添加语句\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT\n其中8080就是新增端口号\n\n## 重启防火墙\nservice iptables restart\n\n## 关闭、开启防火墙\nservice iptables stop/start\n")])])]),a("p",[t._v("​")]),t._v(" "),a("p",[t._v("在浏览器中，访问： http://192.168.134.101:8997    ，注意修改对应的ip地址")]),t._v(" "),a("p",[t._v("​       即可查看到类似如下页面中显示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Welcome to use uwsgi!!!\n")])])]),a("p",[t._v("9、 使用 uwsgi 启动django：")]),t._v(" "),a("p",[t._v("使用 ini格式配置文件，文件名 uwsgi.ini ：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi uwsgi.ini\n")])])]),a("p",[t._v("文件内容：")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[uwsgi]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 虚拟主机模式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("vhost")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" false  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## ip端口如果存在nginx应该为socket，否则为http不能占用nginx的端口否则会出错")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("socket")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 0.0.0.0:8000\t")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 是否主服务器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("master")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 是否多线程")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("enable-threads")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 工作进程数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("workers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 5")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## wsgi.py文件的位置而非uwsgi启动程序文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("wsgi-file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /usr/var/my_env/blog/blog/wsgi.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 项目的根目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("chdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /usr/var/my_env/blog/")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 设置 pid 记录文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("pidfile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /usr/var/my_env/blog/uwsgi.pid")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 后台运行uwsgi, 如果想实时查看日志内容，可以使用 tail -f uwsgi.log")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("daemonize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /usr/var/my_env/blog/uwsgilogs/uwsgi.log")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 由于python版本而出现的no python application错误时写入")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## pythonpath = /usr/var/my_env/blog/lib/python3.6/site-packages")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("daemonize 指定 log 输出， 需要创建对应的 目录")])]),t._v(" "),a("li",[a("p",[t._v("如果是想要通过浏览器访问的话，需要将配置中的 socket =  修改为 http = ，否则会报以下错误：")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("invalid request block size: 21573 (max 4096)...skip  \n")])])]),a("p",[t._v("同时需要在防火墙中开放 8997 端口，如果上面已经开放过了，就不需要再额外处理")]),t._v(" "),a("p",[t._v("若出现以下错误：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("no python application found, check your startup logs for errors\n")])])]),a("ul",[a("li",[a("p",[t._v("wsgi-file文件填写错误")])]),t._v(" "),a("li",[a("p",[t._v("python编译器版本错误（本应3.*却调用了2.*版本）")])]),t._v(" "),a("li",[a("p",[t._v("wsgi.py文件需要注册虚拟环境的site-packages")]),t._v(" "),a("p",[t._v("wsgi.py文件代码应如下所示：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## wsgi.py file begin ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sys\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## add the hellodjango project path into the sys.path")]),t._v("\nsys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<PATH_TO_MY_DJANGO_PROJECT>/hellodjango'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 添加你的项目绝对路径")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## sys.path.append('...../my_env/blog')填入项目根目录的绝对路径")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## add the virtualenv site-packages path to the sys.path")]),t._v("\nsys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<PATH_TO_VIRTUALENV>/Lib/site-packages'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 添加你虚拟环境包绝对路径")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## sys.path.append('...../my_env/blog/lib/python3.*/site-packages')填入项目lib下的python3.*的site-packages路径")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## poiting to the project settings")]),t._v("\nos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("environ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setdefault"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DJANGO_SETTINGS_MODULE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hellodjango.settings"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wsgi "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" get_wsgi_application\n\napplication "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_wsgi_application"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## wsgi.py file end")]),t._v("\n")])])])])]),t._v(" "),a("p",[t._v("启动 uwsgi：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/usr/local/python36/bin/uwsgi --ini /var/www/childrenshop/uwsgi.ini\n")])])]),a("p",[t._v("也可以先创建链接，再运行：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ln /usr/local/python36/bin/uwsgi /usr/bin/uwsgi\n\nuwsgi --ini /var/www/childrenshop/uwsgi.ini\n")])])]),a("p",[t._v("如果不以后台模式启动，会得到如下界面：")]),t._v(" "),a("p",[t._v("备注：")]),t._v(" "),a("p",[t._v("如果需要使用 killall 命令关闭所有的uwsgi进程的话，需要安装库：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install -y psmisc\n")])])]),a("p",[t._v("安装完毕后，可以使用以下命令关闭 uwsgi 进程")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("killall -9 uwsgi\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("tail -f uwsgi.ini ##可以监听uwsgi进程\n")])])]),a("p",[t._v("10、设置启动脚本，service方式（7.0版本）")]),t._v(" "),a("p",[t._v("在/etc/init.d/  目录下建立3个脚本：")]),t._v(" "),a("p",[t._v("uwsgi-start.sh")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('##!/bin/bash -e\n\nexport LD_LIBRARY_PATH="/usr/local/lib"\n\n/usr/local/python36/bin/uwsgi --ini /var/www/childrenshop/uwsgi.ini\n')])])]),a("p",[t._v('说明： export LD_LIBRARY_PATH="/usr/local/lib"   这一行是为了防止 出现 sqlite 版本错误')]),t._v(" "),a("p",[t._v("uwsgi-stop.sh")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("##!/bin/bash -e\n\n/usr/local/python36/bin/uwsgi --stop /var/run/uwsgi.pid\n\n")])])]),a("p",[t._v("说明：/var/run/uwsgi.pid 是在 uwsgi.ini 中配置的")]),t._v(" "),a("p",[t._v("uwsgi-restart.sh")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("##!/bin/bash -e\n\n/usr/local/python36/bin/uwsgi --reload /var/run/uwsgi.pid\n")])])]),a("p",[t._v("脚本赋予权限：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("chmod 755 uwsgi-start.sh\nchmod 755 uwsgi-stop.sh\nchmod 755 uwsgi-restart.sh\n")])])]),a("p",[t._v("编写service脚本：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi /usr/lib/systemd/system/uwsgi.service\n\n")])])]),a("p",[t._v("填入以下内容：")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[Unit]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Description")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("uwsgi")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("After")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("network.target")]),t._v("\n   \n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[Service]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("forking")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PIDFile")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/var/run/uwsgi.pid")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/etc/init.d/uwsgi-start.sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/etc/init.d/uwsgi-restart.sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ExecStop")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/etc/init.d/uwsgi-stop.sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PrivateTmp")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true")]),t._v("\n   \n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[Install]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("multi-user.target")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("以上出现的路径必须是绝对路径")])]),t._v(" "),a("li",[a("p",[t._v("ExecStart、ExecReload、ExecStop 3个分别对应 启动、重新启动、停止")])]),t._v(" "),a("li",[a("p",[t._v("PIDFile 对应启动后的 pid 保存文件")])])]),t._v(" "),a("p",[t._v("设置自启动")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemctl enable uwsgi.service\n")])])]),a("p",[t._v("说明： .service  可以省略")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("## 启动\nsystemctl start uwsgi\n\n## 停止\nsystemctl stop uwsgi\n\n## 重启\nsystemctl restart uwsgi\n")])])]),a("p",[t._v("10.1 systemctl是centos7.0版本代替centos6.*版本的service 和 chkconfig的")]),t._v(" "),a("p",[t._v("通过service 和 chkconfig设置自启动和系统脚本")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 直接执行脚本")]),t._v("\n/etc/init.d/netword restart\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 通过 service 命令执行脚本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" network restart\n")])])]),a("p",[t._v("service 等同于netword")]),t._v(" "),a("p",[t._v("在/etc/init.d/下创建自定义脚本文件：my-uwsgi")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi /etc/init.d/my-uwsgi\n")])])]),a("p",[t._v("在my-uwsgi写入")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('##!/bin/bash\n##chkconfig:35 85 15\nDAEMON=/usr/local/python3/bin/uwsgi\ncase "$1" in\nstart)\n  echo "Starting uwsgi daemon..."\n  export LD_LIBRARY_PATH="/usr/lib"\n  $DAEMON --ini /usr/var/my_env/releaseVol1/uwsgi.ini && echo "SUCCESS"\n  ;;  \nstop)\n  echo "Stopping uwsgi deamon..."\n  $DAEMON --stop /usr/var/my_env/releaseVol1/uwsgi.pid && echo "SUCCESS"\n  ;;  \nrestart)\n  echo "Restarting uwsgi deamon"\n  $DAEMON --reload /usr/var/my_env/releaseVol1/uwsgi.pid && echo "SUCCESS"\n  ;;  \n*)\n  echo "Usage:service nginx{start|stop|reload|restart}"\n  exit 2\n  ;;  \nesac\n')])])]),a("p",[t._v("其中uwsgi.pid和uwsgi.ini都是绝对路径， ##chkconfig:35 85 15设定了开机自启动配置")]),t._v(" "),a("p",[t._v("也可以通过指令chkconfig操作")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("## 添加自启动指令\nchkconfig --add my-uwsgi\n## 删除自启动指令\nchkconfig --del my-uwsgi\n## 查看开机自启动列表\nchkconfig --list\n")])])]),a("p",[t._v("最后给my-uwsgi添加权限")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("chmod 755 my-uwsgi\n")])])]),a("h4",{attrs:{id:"_6、安装和使用nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、安装和使用nginx"}},[t._v("#")]),t._v(" 6、安装和使用nginx")]),t._v(" "),a("h6",{attrs:{id:"_1-配置说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置说明"}},[t._v("#")]),t._v(" 1.配置说明")]),t._v(" "),a("p",[t._v('​\tNginx服务器的配置信息主要集中在"nginx.conf"这个配置文件中（默认为/usr/local/nginx/conf/nginx.conf），所有的可配置项主要为以下几点：')]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[t._v("main                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 全局配置")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 工作模式配置")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## http设置")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 服务器主机配置（虚拟主机、反向代理等）")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" \\ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 路由配置（虚拟目录等）")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" otherpath "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 负载均衡配置")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("各模块中主要的配置为：")]),t._v(" "),a("p",[t._v("######## 1.main模块")]),t._v(" "),a("ul",[a("li",[t._v("user：用来指定nginx worker进程运行用户以及用户组，默认nobody账号运行")]),t._v(" "),a("li",[t._v("worker_processes：指定nginx要开启的子进程数量，运行过程中监控每个进程消耗内存(一般几M~几十M不等)根据实际情况进行调整，通常数量是CPU内核数量的整数倍")]),t._v(" "),a("li",[t._v("error_log：定义错误日志文件的位置及输出级别【debug / info / notice / warn / error / crit】")]),t._v(" "),a("li",[t._v("pid：用来指定进程id的存储文件的位置")]),t._v(" "),a("li",[t._v("worker_rlimit_nofile：用于指定一个进程可以打开最多文件数量的描述")])]),t._v(" "),a("p",[t._v("######## 2.event模块")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("worker_connections：指定最大可以同时接收的连接数量，这里一定要注意，最大连接数量是和worker_processes共同决定的，理论上是worker_processes*worker_connections")])]),t._v(" "),a("li",[a("p",[t._v("multi_accept：配置指定nginx在收到一个新连接通知后尽可能多的接受更多的连接")])]),t._v(" "),a("li",[a("p",[t._v("use epoll：配置指定了线程轮询的方法，如果是linux2.6+，使用epoll，如果是BSD如Mac请使用Kqueue")])])]),t._v(" "),a("p",[t._v("######## 3.http模块")]),t._v(" "),a("p",[t._v("作为web服务器，http模块是nginx最核心的一个模块，配置项也是比较多的，项目中会设置到很多的实际业务场景，需要根据硬件信息进行适当的配置。")]),t._v(" "),a("p",[t._v("########## 1.基础配置")]),t._v(" "),a("ul",[a("li",[t._v("sendfile on：配置on让sendfile发挥作用，将文件的回写过程交给数据缓冲去完成，而不是放在应用中完成，这样的话在性能提升有有好处")]),t._v(" "),a("li",[t._v("tcp_nopush on：让nginx在一个数据包中发送所有的头文件，而不是一个一个单独发")]),t._v(" "),a("li",[t._v("tcp_nodelay on：让nginx不要缓存数据，而是一段一段发送，如果数据的传输有实时性的要求的话可以配置它，发送完一小段数据就立刻能得到返回值，但是不要滥用哦")]),t._v(" "),a("li",[t._v("keepalive_timeout 10：给客户端分配连接超时时间，服务器会在这个时间过后关闭连接。一般设置时间较短，可以让nginx工作持续性更好")]),t._v(" "),a("li",[t._v("client_header_timeout 10：设置请求头的超时时间")]),t._v(" "),a("li",[t._v("client_body_timeout 10:设置请求体的超时时间")]),t._v(" "),a("li",[t._v("send_timeout 10：指定客户端响应超时时间，如果客户端两次操作间隔超过这个时间，服务器就会关闭这个连接")]),t._v(" "),a("li",[t._v("limit_conn_zone $binary_remote_addr zone=addr:5m ：设置用于保存各种key的共享内存的参数，")]),t._v(" "),a("li",[t._v("limit_conn addr 100: 给定的key设置最大连接数")]),t._v(" "),a("li",[t._v("server_tokens：虽然不会让nginx执行速度更快，但是可以在错误页面关闭nginx版本提示，对于网站安全性的提升有好处哦")]),t._v(" "),a("li",[t._v("include /etc/nginx/mime.types：指定在当前文件中包含另一个文件的指令")]),t._v(" "),a("li",[t._v("default_type application/octet-stream：指定默认处理的文件类型可以是二进制")]),t._v(" "),a("li",[t._v("type_hash_max_size 2048：混淆数据，影响三列冲突率，值越大消耗内存越多，散列key冲突率会降低，检索速度更快；值越小key，占用内存较少，冲突率越高，检索速度变慢")])]),t._v(" "),a("p",[t._v("########## 2.日志配置")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("access_log logs/access.log：设置存储访问记录的日志")])]),t._v(" "),a("li",[a("p",[t._v("error_log logs/error.log：设置存储记录错误发生的日志")])])]),t._v(" "),a("p",[t._v("########## 3.SSL证书配置")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("ssl_protocols：指令用于启动特定的加密协议，nginx在1.1.13和1.0.12版本后默认是ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2，TLSv1.1与TLSv1.2要确保OpenSSL >= 1.0.1 ，SSLv3 现在还有很多地方在用但有不少被攻击的漏洞。")])]),t._v(" "),a("li",[a("p",[t._v("ssl prefer server ciphers：设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件")])])]),t._v(" "),a("p",[t._v("########## 4.压缩配置")]),t._v(" "),a("ul",[a("li",[t._v("gzip 是告诉nginx采用gzip压缩的形式发送数据。这将会减少我们发送的数据量。")]),t._v(" "),a("li",[t._v("gzip_disable 为指定的客户端禁用gzip功能。我们设置成IE6或者更低版本以使我们的方案能够广泛兼容。")]),t._v(" "),a("li",[t._v("gzip_static 告诉nginx在压缩资源之前，先查找是否有预先gzip处理过的资源。这要求你预先压缩你的文件，从而允许你使用最高压缩比，这样nginx就不用再压缩这些文件了")]),t._v(" "),a("li",[t._v("gzip_proxied 允许或者禁止压缩基于请求和响应的响应流。我们设置为any，意味着将会压缩所有的请求。")]),t._v(" "),a("li",[t._v("gzip_min_length 设置对数据启用压缩的最少字节数。如果一个请求小于1000字节，我们最好不要压缩它，因为压缩这些小的数据会降低处理此请求的所有进程的速度。")]),t._v(" "),a("li",[t._v("gzip_comp_level 设置数据的压缩等级。这个等级可以是1-9之间的任意数值，9是最慢但是压缩比最大的。我们设置为4，这是一个比较折中的设置。")]),t._v(" "),a("li",[t._v("gzip_type 设置需要压缩的数据格式")])]),t._v(" "),a("p",[t._v("########## 5.文件缓存配置")]),t._v(" "),a("ul",[a("li",[t._v("open_file_cache 打开缓存的同时也指定了缓存最大数目，以及缓存的时间。我们可以设置一个相对高的最大时间，这样我们可以在它们不活动超过20秒后清除掉。")]),t._v(" "),a("li",[t._v("open_file_cache_valid 在open_file_cache中指定检测正确信息的间隔时间。")]),t._v(" "),a("li",[t._v("open_file_cache_min_uses 定义了open_file_cache中指令参数不活动时间期间里最小的文件数。")]),t._v(" "),a("li",[t._v("open_file_cache_errors 指定了当搜索一个文件时是否缓存错误信息，也包括再次给配置中添加文件。我们也包括了服务器模块，这些是在不同文件中定义的。如果你的服务器模块不在这些位置，你就得修改这一行来指定正确的位置。")])]),t._v(" "),a("p",[t._v("########## 6.server模块")]),t._v(" "),a("p",[t._v("​\tserver模块配置是http模块中的一个子模块，用来定义一个虚拟访问主机，也就是一个虚拟服务器的配置信息。")]),t._v(" "),a("p",[t._v("​\t类似：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("    localhost "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".134")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".130")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("charset")]),t._v("        utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v("     logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_log")]),t._v("      logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("server：一个虚拟主机的配置，一个http中可以配置多个server")]),t._v(" "),a("li",[t._v("server_name：用来指定ip地址或者域名，多个配置之间用空格分隔")]),t._v(" "),a("li",[t._v("charset：用于设置www/路径中配置的网页的默认编码格式")]),t._v(" "),a("li",[t._v("access_log：用于指定该虚拟主机服务器中的访问记录日志存放路径")]),t._v(" "),a("li",[t._v("error_log：用于指定该虚拟主机服务器中访问错误日志的存放路径")])]),t._v(" "),a("p",[t._v("########## 7.location模块")]),t._v(" "),a("p",[t._v("​\tlocation模块是Nginx配置中出现最多的一个配置，主要用于配置路由访问信息，属于http下的server下的子模块。")]),t._v(" "),a("p",[t._v("​\t在路由访问信息配置中关联到反向代理、负载均衡等等各项功能，所以location模块也是一个非常重要的配置模块。")]),t._v(" "),a("ol",[a("li",[t._v("基本配置")])]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("location /：表示匹配访问根目录")])]),t._v(" "),a("li",[a("p",[t._v("root：用于指定访问根目录时，访问虚拟主机的web目录")])]),t._v(" "),a("li",[a("p",[t._v("index：在不指定访问具体资源时，默认展示的资源文件列表")])])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("反向代理配置")])]),t._v(" "),a("p",[t._v("通过反向代理代理服务器访问模式，通过代理配置让客户端访问透明化。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-real-ip $remote_addr'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("location / :  其中的 / 指明是url根路径")])]),t._v(" "),a("li",[a("p",[t._v("proxy_pass：代理的目标，ip和端口")])]),t._v(" "),a("li",[a("p",[t._v("proxy_set_header：代理后，添加的header")])])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("uWSGI配置")])]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v(" uwsgi_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    uwsgi_pass localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("include： 指定uwsgi的配置参数")]),t._v(" "),a("li",[t._v("uwsgi_pass：uWSGI服务器的IP和端口")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("静态文件")])]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("static"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test_project"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("static"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("/static/： url的起始path")]),t._v(" "),a("li",[t._v("alias： 指定服务器的静态文件目录")])]),t._v(" "),a("p",[t._v("########## 8.负载均衡模块（upstream）")]),t._v(" "),a("p",[t._v("upstream模块主要负责负载均衡的配置，通过默认的轮询调度方式来分发请求到后端服务器。简单的配置方式如下。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##ip_hash;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v(" weight"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8001")]),t._v(" down"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".103")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8002")]),t._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".104")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8003")]),t._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".105")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8004")]),t._v(" max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("ip_hash：指定请求调度算法，默认是weight权重轮询调度，可以指定")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("默认没有配置时，采取轮询，配合weight，譬如配置如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("upstream name {\n    server 192.168.1.101:8000;\n    server 192.168.1.102:8001 weight=2;\n}\n")])])]),a("p",[t._v("那么用户发送请求时，会执行执行这样的逻辑： 8000端口一次， 8001端口两次。。。循环")])]),t._v(" "),a("li",[a("p",[t._v("ip_hash：根据客户端ip的hash值决定服务器，这样每个ip的客户端固定访问一个服务器")])]),t._v(" "),a("li",[a("p",[t._v("least_conn：请求将被分配到活动连接数量最少的服务器")])]),t._v(" "),a("li",[a("p",[t._v("fair：按后端服务器的响应时间来请求分配，响应时间短的优先分配")])]),t._v(" "),a("li",[a("p",[t._v("url_hash：按访问url的hash结果来分配请求，按每个url定向到同一个后端服务器，后端服务器为缓存时比较有效")])])])]),t._v(" "),a("li",[a("p",[t._v("server host:port：分发服务器的列表配置")])]),t._v(" "),a("li",[a("p",[t._v("down：表示该主机暂停服务")])]),t._v(" "),a("li",[a("p",[t._v("max_fails：表示失败最大次数，超过失败最大次数暂停服务")])]),t._v(" "),a("li",[a("p",[t._v("fail_timeout：表示如果请求受理失败，暂停指定的时间之后重新发起请求")])])]),t._v(" "),a("h6",{attrs:{id:"_2-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装"}},[t._v("#")]),t._v(" 2.安装")]),t._v(" "),a("p",[t._v("1、 gcc 安装")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install gcc-c++\n")])])]),a("p",[t._v("2、 PCRE pcre-devel 安装")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install -y pcre pcre-devel\n")])])]),a("p",[t._v("3、 zlib 安装")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install -y zlib zlib-devel\n")])])]),a("p",[t._v("4、 openssl 安装")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install -y openssl openssl-devel\n")])])]),a("p",[t._v("5、 安装nginx， 官网地址："),a("a",{attrs:{href:"https://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://nginx.org/en/download.html"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("可以手动去官网下载对应的版本，然后拷贝到linux系统中")]),t._v(" "),a("p",[t._v("也可以使用 wget 下载")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wget -c https://nginx.org/download/nginx-1.14.0.tar.gz\n")])])]),a("p",[t._v("6、 下载完成后，进行解压：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("tar -zxvf nginx-1.14.0.tar.gz\n")])])]),a("p",[t._v("7、 进入解压后的目录")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd nginx-1.14.0\n")])])]),a("p",[t._v("8、 应用默认配置，执行")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('## 默认安装\n./configure\n\n## 指定一些特定参数的安装\n./configure --with-http_ssl_module --prefix="/install/program/nginx" --with-http_stub_status_module\n')])])]),a("p",[t._v("9、 执行编译：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("make\n")])])]),a("p",[t._v("10、执行安装：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("make install\n")])])]),a("p",[t._v("11、查看安装路径：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("whereis nginx\n")])])]),a("p",[t._v("路径默认在： /usr/local/nginx")]),t._v(" "),a("p",[t._v("12、常用命令：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("## 首先进行nginx安装目录下的 sbin 目录\ncd /usr/local/nginx/sbin\n\n## 启动nginx\n./nginx\n\n## 停止nginx：\n## 此方式停止步骤是待nginx进程处理任务完毕进行停止，推荐这个\n./nginx -s quit\n\n## 此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程\n./nginx -s stop\n\n## 查看nginx进程\nps aux|grep nginx\n\n## 验证配置文件：\n./nginx -t\n\n## 修改了nginx的配置文件，如果需要重新加载配置文件，使用：\n./nginx -s reload\n\n")])])]),a("p",[t._v("13、启动nginx后，可以查看端口监听情况")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("netstat -tlnp\n")])])]),a("p",[t._v("14、关闭linux防火墙或者开放nginx的端口，在浏览器中访问，即可查看到对应的欢迎页面")]),t._v(" "),a("p",[t._v("15、设置nginx为开机启动")]),t._v(" "),a("ul",[a("li",[t._v("简单方式：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("## 编辑文件：\nvi /etc/rc.local\n\n## 增加一行 \n/usr/local/nginx/sbin/nginx\n\n## 设置权限\nchmod 755 /etc/rc.local\n")])])]),a("ul",[a("li",[t._v("service方式：")])]),t._v(" "),a("p",[t._v("编写service脚本：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi /usr/lib/systemd/system/nginx.service\n")])])]),a("p",[t._v("填入以下内容：")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[Unit]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Description")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("nginx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("After")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("network.target")]),t._v("\n   \n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[Service]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("forking")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PIDFile")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/usr/local/nginx/logs/nginx.pid")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx -s reload")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ExecStop")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/usr/local/nginx/sbin/nginx -s quit")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PrivateTmp")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true")]),t._v("\n   \n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[Install]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("multi-user.target")]),t._v("\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("以上出现的路径必须是绝对路径")]),t._v(" "),a("li",[t._v("ExecStart、ExecReload、ExecStop 3个分别对应 启动、重新启动、停止")]),t._v(" "),a("li",[t._v("PIDFile 对应启动后的 pid 保存文件")])]),t._v(" "),a("p",[t._v("设置自启动")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemctl enable nginx.service\n")])])]),a("p",[t._v("说明： .service可以省略")]),t._v(" "),a("h6",{attrs:{id:"_3-配置项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置项目"}},[t._v("#")]),t._v(" 3.配置项目")]),t._v(" "),a("p",[t._v("1、nginx配置")]),t._v(" "),a("p",[t._v("配置文件位置：在 /usr/local/nginx/conf/nginx.conf")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("###################### 每个指令必须有分号结束。##################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 配置用户或者组，默认为nobody nobody。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## user administrator administrators;  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##允许生成的进程数，默认为1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## worker_processes 2;  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 指定nginx进程运行文件存放地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pid")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别依次为：debug|info|notice|warn|error|crit")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_log")]),t._v(" logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##设置网路连接序列化，防止惊群现象发生，默认为on")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("accept_mutex")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##设置一个进程是否同时接受多个网络连接，默认为off")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("multi_accept")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##use epoll;    ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##最大连接数，默认为 1024")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_connections")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##文件扩展名与文件类型映射表")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v("       mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("types")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##默认文件类型，默认为text/plain")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v("  application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("octet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 取消服务日志   ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##access_log off;  ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##自定义格式")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_format")]),t._v(" myFormat "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##combined为日志格式的默认值")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log myFormat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile_max_chunk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##连接超时时间，默认为75秒，可以在http，server，location块设置。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keepalive_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 端口")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 虚拟主机名，发布到互联网上写 域名，如:  *.test.com")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 默认编码")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("charset")]),t._v(" utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 路径")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 开启对http1.1支持")]),t._v("\n            \t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_http_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 设置Connection为空串, 以禁止传递头部到后端")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        \n        \t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 包含 uwsgi配置，这个是相对路径，也可以使用绝对路径")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v(" uwsgi_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## uwsgi的端口")]),t._v("\n                uwsgi_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8998")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     \n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 指定连接到后端uWSGI的超时时间。")]),t._v("\n                uwsgi_send_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 指定向uWSGI传送请求的超时时间，完成握手后向uWSGI传送请求的超时时间。")]),t._v("\n                uwsgi_connect_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 指定接收uWSGI应答的超时时间，完成握手后接收uWSGI应答的超时时间。")]),t._v("\n                uwsgi_read_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 静态文件，和django项目中的settings中配置的 STATIC_URL = '/static/' 相对应")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("static"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 执行 collectstatic 合并静态文件之后的目录")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("releaseVol1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("static"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 媒体文件，用户上传的文件")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##location /media/ {")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##        alias /var/www/childrenshop/media/;")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##error_page  404              /404.html;")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 将服务器的错误页面重定向到静态页面 /50x.html")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_page")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("2、访问")]),t._v(" "),a("p",[t._v("在防火墙中开放对应的端口，譬如：8996")]),t._v(" "),a("p",[t._v("在浏览器中访问即可")]),t._v(" "),a("p",[t._v("注意：别忘记将 uwsgi.ini 的配置中端口配置的 http = 修改为 socket =")]),t._v(" "),a("p",[t._v("3、实现负载均衡")]),t._v(" "),a("p",[t._v("在本文档中演示第二个uwsgi，复制一份新的配置文件，修改后，启动：")]),t._v(" "),a("p",[t._v("uwsgi1.ini")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[uwsgi]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 虚拟主机模式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("vhost")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## ip端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("socket")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 0.0.0.0:8998")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 是否主服务器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("master")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 是否多线程")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("enable-threads")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 工作进程数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("workers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 5")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## wsgi文件的位置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("wsgi-file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /var/www/childrenshop/middleware_study/wsgi.py")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 项目的根目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("chdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /var/www/childrenshop/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##limit-as = 256")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("pidfile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /var/run/uwsgi1.pid")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("daemonize")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /var/www/childrenshop/logs/uwsgi1.log")]),t._v("\n\n")])])]),a("p",[t._v("启动 uwsgi1")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/usr/local/python36/bin/uwsgi --ini /var/www/childrenshop/uwsgi1.ini\n")])])]),a("p",[t._v("nginx.conf：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 和 server 平级配置，写在server上面")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" mycom "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 采用默认轮询")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## ip_hash;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8997")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8998")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## server下的 location 配置中，修改：")]),t._v("\nuwsgi_pass mycom"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[t._v("4、测试访问，同时监听2个uwsgi服务器日志输出，可以看到负载均衡的效果")]),t._v(" "),a("p",[t._v("5.子路径")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" server {\n                listen 80;\n                server_name  testapp.com;\n                location / {\n                        root /usr/share/nginx/html/official_web/; \n                        index  index.html index.htm;\n                        ## try_files $uri $uri/ /index.html;\n                }\n                ###### oms ######\n                location  /oms {\n                     alias /usr/share/nginx/html/oms;   ##注意就是这一行，根路径除了首个root其余都应该为alias\n                     index index.html index.htm;\n                     ## try_files $uri $uri/ /oms/index.html;\n                }\n                ## ......  ##\n        }\n")])])]),a("h6",{attrs:{id:"_4-外网访问虚拟机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-外网访问虚拟机"}},[t._v("#")]),t._v(" 4.外网访问虚拟机")]),t._v(" "),a("p",[t._v("需要修改nginx.conf")]),t._v(" "),a("p",[t._v("将server_name  修改为域名;")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inotes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##如果主机的ip地址更改如重连了无线，则需要将去对应网站修改域名解析")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\n")])])]),a("p",[t._v("在vm（虚拟机）中配置NAT网络设置，Mac通过command+','调出偏好设置")]),t._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('  <img src="/Users/qyp/Desktop/屏幕快照 2021-01-05 23.38.15.png" alt="屏幕快照 2021-01-05 23.38.15" style="zoom:50%;" />\n\n')])])]),a("p",[t._v("重启network")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("service network restart\n")])])]),a("p",[t._v("这样就把虚拟机的ip:post和主机的端口映射，这里的虚拟机端口应与nignx对应，相当于将主机当做一个路由而虚拟机为一个分机")]),t._v(" "),a("p",[t._v("最后需要在路由器页面设置DMZ主机")]),t._v(" "),a("p",[t._v("![屏幕快照 2021-01-05 23.43.56](/Users/qyp/Desktop/屏幕快照 2021-01-05 23.43.56.png)")]),t._v(" "),a("p",[t._v("如果连接有线，可以固定本机ip")]),t._v(" "),a("p",[t._v("在路由设置 >> 网络参数中设置")])])}),[],!1,null,null,null);s.default=e.exports}}]);